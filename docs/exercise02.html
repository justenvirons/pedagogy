<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="C. Scott Smith, PhD AICP (Instructor)">
<meta name="dcterms.date" content="2023-10-09">

<title>GEO 3/446 Exercise #2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="exercise02_files/libs/clipboard/clipboard.min.js"></script>
<script src="exercise02_files/libs/quarto-html/quarto.js"></script>
<script src="exercise02_files/libs/quarto-html/popper.min.js"></script>
<script src="exercise02_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="exercise02_files/libs/quarto-html/anchor.min.js"></script>
<link href="exercise02_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="exercise02_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="exercise02_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="exercise02_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="exercise02_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a></li>
  <li><a href="#step-1.-create-and-prepare-a-new-r-project" id="toc-step-1.-create-and-prepare-a-new-r-project" class="nav-link" data-scroll-target="#step-1.-create-and-prepare-a-new-r-project">Step 1. Create and prepare a new R project</a>
  <ul class="collapse">
  <li><a href="#install-and-activate-r-packages" id="toc-install-and-activate-r-packages" class="nav-link" data-scroll-target="#install-and-activate-r-packages">Install and activate R packages</a></li>
  <li><a href="#create-data-processing-script-in-r" id="toc-create-data-processing-script-in-r" class="nav-link" data-scroll-target="#create-data-processing-script-in-r">Create data processing script in R</a></li>
  <li><a href="#download-and-extract-aermod-related-files" id="toc-download-and-extract-aermod-related-files" class="nav-link" data-scroll-target="#download-and-extract-aermod-related-files">Download and extract AERMOD-related files</a></li>
  </ul></li>
  <li><a href="#step-2.-download-and-transform-emissions-and-toxicity-data" id="toc-step-2.-download-and-transform-emissions-and-toxicity-data" class="nav-link" data-scroll-target="#step-2.-download-and-transform-emissions-and-toxicity-data">Step 2. Download and transform emissions and toxicity data</a>
  <ul class="collapse">
  <li><a href="#download-nei-data" id="toc-download-nei-data" class="nav-link" data-scroll-target="#download-nei-data">Download NEI data</a></li>
  <li><a href="#download-tri-data" id="toc-download-tri-data" class="nav-link" data-scroll-target="#download-tri-data">Download TRI data</a></li>
  <li><a href="#download-rsei-data" id="toc-download-rsei-data" class="nav-link" data-scroll-target="#download-rsei-data">Download RSEI data</a></li>
  <li><a href="#create-and-write-shapefiles" id="toc-create-and-write-shapefiles" class="nav-link" data-scroll-target="#create-and-write-shapefiles">Create and write shapefiles</a></li>
  </ul></li>
  <li><a href="#step-3.-create-and-add-data-to-arcgis-pro-project" id="toc-step-3.-create-and-add-data-to-arcgis-pro-project" class="nav-link" data-scroll-target="#step-3.-create-and-add-data-to-arcgis-pro-project">Step 3. Create and add data to ArcGIS Pro project</a>
  <ul class="collapse">
  <li><a href="#add-nei-and-tri-to-arcgis-pro" id="toc-add-nei-and-tri-to-arcgis-pro" class="nav-link" data-scroll-target="#add-nei-and-tri-to-arcgis-pro">Add NEI and TRI to ArcGIS Pro</a></li>
  <li><a href="#download-and-add-air-basin-boundaries-to-arcgis-pro" id="toc-download-and-add-air-basin-boundaries-to-arcgis-pro" class="nav-link" data-scroll-target="#download-and-add-air-basin-boundaries-to-arcgis-pro">Download and add air basin boundaries to ArcGIS Pro</a></li>
  <li><a href="#download-meteorological-data" id="toc-download-meteorological-data" class="nav-link" data-scroll-target="#download-meteorological-data">Download meteorological data</a></li>
  </ul></li>
  <li><a href="#step-4.-create-and-center-study-area" id="toc-step-4.-create-and-center-study-area" class="nav-link" data-scroll-target="#step-4.-create-and-center-study-area">Step 4. Create and center study area</a></li>
  <li><a href="#step-5.-model-single-facility-pollutant-so2-concentrations-using-aermod" id="toc-step-5.-model-single-facility-pollutant-so2-concentrations-using-aermod" class="nav-link" data-scroll-target="#step-5.-model-single-facility-pollutant-so2-concentrations-using-aermod">Step 5. Model single facility pollutant (SO2) concentrations using AERMOD</a>
  <ul class="collapse">
  <li><a href="#customize-parameters-in-the-aermod-input-file-aermod.inp" id="toc-customize-parameters-in-the-aermod-input-file-aermod.inp" class="nav-link" data-scroll-target="#customize-parameters-in-the-aermod-input-file-aermod.inp">Customize parameters in the AERMOD input file (AERMOD.INP)</a></li>
  <li><a href="#run-the-aermod-model-with-custom-parameters" id="toc-run-the-aermod-model-with-custom-parameters" class="nav-link" data-scroll-target="#run-the-aermod-model-with-custom-parameters">Run the AERMOD model with custom parameters</a></li>
  <li><a href="#reformat-model-output-data-and-export-as-ascii-grid" id="toc-reformat-model-output-data-and-export-as-ascii-grid" class="nav-link" data-scroll-target="#reformat-model-output-data-and-export-as-ascii-grid">Reformat model output data and export as ASCII grid</a></li>
  </ul></li>
  <li><a href="#step-6.-create-final-maps-and-figures-in-arcgis-pro" id="toc-step-6.-create-final-maps-and-figures-in-arcgis-pro" class="nav-link" data-scroll-target="#step-6.-create-final-maps-and-figures-in-arcgis-pro">Step 6. Create final maps and figures in ArcGIS Pro</a></li>
  <li><a href="#cumulative-emissions-optional" id="toc-cumulative-emissions-optional" class="nav-link" data-scroll-target="#cumulative-emissions-optional">Cumulative emissions <em>(optional)</em></a></li>
  <li><a href="#model-seasonal-variation-in-toxic-air-concentrations-optional" id="toc-model-seasonal-variation-in-toxic-air-concentrations-optional" class="nav-link" data-scroll-target="#model-seasonal-variation-in-toxic-air-concentrations-optional">Model seasonal variation in toxic air concentrations <em>(optional)</em></a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">GEO 3/446 Exercise #2</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">Air Dispersion Modeling and Visualization</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>C. Scott Smith, PhD AICP (Instructor) </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 9, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>Air quality (both outdoor/ambient and indoor/household) is associated with a broad range of disease outcomes (e.g., asthma, cancer) and is globally responsible for millions of deaths each year <span class="citation" data-cites="landrigan2017">(<a href="#ref-landrigan2017" role="doc-biblioref">Landrigan 2017</a>)</span>. The Clean Air Act (CAA) is the comprehensive US federal law that regulates air emissions from stationary and mobile sources<span class="citation" data-cites="usepa2013">(<a href="#ref-usepa2013" role="doc-biblioref">US EPA 2013</a>)</span>. Among other things, the Act authorizes the US Environmental Protection Agency (EPA) to establish National Ambient Air Quality Standards (NAAQS) <span class="citation" data-cites="usepa2014">(<a href="#ref-usepa2014" role="doc-biblioref">EPA 2014</a>)</span> designed to protect public health from six outdoor air pollutants: particulate matter, ozone, nitrogen oxides, sulfur dioxide, carbon monoxide and lead (“criteria” pollutants). The EPA is also required to identify and regulate emissions of hazardous air pollutants (HAPs) which, since 1990, includes <a href="https://www.epa.gov/haps/initial-list-hazardous-air-pollutants-modifications">188 pollutants</a>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Additional reading on the effects of air pollution on health
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Each year, the American Lung Association publishes its annual <a href="https://www.lung.org/research/sota">State of the Air report</a> <span class="citation" data-cites="ala2023">(<a href="#ref-ala2023" role="doc-biblioref">ALA 2023</a>)</span>which examines two of the most widespread and dangerous pollutants from this group, particulate matter and ozone. Other readings concerning the environmental justice implications of land use planning and toxic air pollution include “Incompatible Land Uses and the Topology of Cumulative Risk” <span class="citation" data-cites="lejano2006b">(<a href="#ref-lejano2006b" role="doc-biblioref">Lejano and Smith 2006</a>)</span> and “Concentrating risk? The geographic concentration of health risk from industrial air toxics across America” <span class="citation" data-cites="ard2020">(<a href="#ref-ard2020" role="doc-biblioref">Ard and Bullock 2020</a>)</span>.</p>
</div>
</div>
</div>
<p>This exercise involves the evaluation of ambient air concentrations of criteria and toxic pollutants within a student-specified area in California. Students will model concentrations using regularly updated, facility-level emissions made available from the EPA (i.e., <a href="https://www.epa.gov/air-emissions-inventories/national-emissions-inventory-nei">AirData National Emmissions Inventory</a> and <a href="https://www.epa.gov/toxics-release-inventory-tri-program">Toxic Release Inventory</a>), hourly meteorological data from local weather stations and <a href="https://www.epa.gov/scram/air-quality-dispersion-modeling-preferred-and-recommended-models">AERMOD</a>, an air dispersion model developed by the EPA.</p>
<p>AERMOD is presently the model recommended for US government agencies to estimate pollutant concentrations from stationary (and mobile) sources in urban areas. AERMOD allows for the specification of multiple sources, facility-specific release patterns (it also allows for specification of uneven terrain and effects of nearby building downwash, but we won’t take advantage of these functions in this exercise). The model requires that hourly wind patterns (direction and speed) and temperature data be input. Near-field models like AERMOD differ from far-field models in that the former are able to capture initial mixing phenomena that occur just after the plume leaves the source (such as a smokestack). The AERMOD near-field model is best suited for study areas no greater than 50km by 50km. For this exercise, students will model a custom study area with dimensions 10km by 10km.</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="images/fisk.png" class="img-fluid"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="images/emissions.png" class="img-fluid"></p>
</div>
</div>
</div>
<p>Students will save maps, tables and summaries of spatial analyses in a <a href="https://github.com/justenvirons/pedagogy/blob/main/GEO346_2023_FallQuarter/Exercise_02/exercise02-template.pptx">PowerPoint presentation</a> (or, optionally, a document created with Quarto markdown in R) to be submitted via the course web page. Students are welcome to work collectively with classmates to overcome obstacles experienced while completing the required tasks, although all submissions will be unique given that students will choose their own study areas that have different distributions of pollution sources (and therefore different patterns of air pollutant concentrations). Of course the interpretations will also be your own. As in all assignments for this class, you will be asked to not only produce attractive (strive for cartographic perfection!) and meaningful maps, but also describe patterns presented within them. The three sections below step you through the process to create the above deliverable. (For some of the more complicated procedures, online videos will be made available on the course D2L under the Exercise #2 content folder.)</p>
</section>
<section id="step-1.-create-and-prepare-a-new-r-project" class="level2">
<h2 class="anchored" data-anchor-id="step-1.-create-and-prepare-a-new-r-project">Step 1. Create and prepare a new R project</h2>
<p>In RStudio, create a project within a new directory (e.g., GEO336/exercise_02) of your general course folder. Here you will save files related to exercise #2. Create the following folders within the new exercise-specific directory, “aermod”, “data”, “maps” and “scripts”.</p>
<section id="install-and-activate-r-packages" class="level3">
<h3 class="anchored" data-anchor-id="install-and-activate-r-packages">Install and activate R packages</h3>
<p>Use the following code to activate the packages required to download and transform data needed for the exercise.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(c("dplyr", "tidyverse", "openxlsx","sf", "sp")) if necessary</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># data wrangling with pipe syntax</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># data wrangling</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx) <span class="co"># use for importing data in Excel format</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># simple features data package </span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp) <span class="co"># spatial data package</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># creating plots</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych) <span class="co"># calculating summary statistics</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster) <span class="co"># create raster dataset</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">999</span>, <span class="at">digits =</span> <span class="dv">2</span>) <span class="co"># format output for data tables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-data-processing-script-in-r" class="level3">
<h3 class="anchored" data-anchor-id="create-data-processing-script-in-r">Create data processing script in R</h3>
<p>In RStudio, create a new script file for storing data processing code relevant to this exercise. Create the blank script file by first navigating to the “scripts” directory you created in your project working directory and clicking “New Blank File” in the files pane. Name the script something intuitive (e.g., “exercise02.R”).</p>
</section>
<section id="download-and-extract-aermod-related-files" class="level3">
<h3 class="anchored" data-anchor-id="download-and-extract-aermod-related-files">Download and extract AERMOD-related files</h3>
<p>Use the following code to download the <a href="https://github.com/justenvirons/pedagogy/blob/main/GEO346_2023_FallQuarter/Exercise_02/data/aermod.zip">AERMOD zip file</a> from the GitHub repository into your project directory and extract the file’s contents into an “aermod” folder. The contents of this folder include the aermod air dispersion executable file as well as other useful reference information.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">"https://github.com/justenvirons/pedagogy/raw/main/GEO346_2023_FallQuarter/Exercise_02/data/aermod.zip"</span>,temp)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(temp, <span class="at">exdir=</span> <span class="st">"aermod"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="step-2.-download-and-transform-emissions-and-toxicity-data" class="level2">
<h2 class="anchored" data-anchor-id="step-2.-download-and-transform-emissions-and-toxicity-data">Step 2. Download and transform emissions and toxicity data</h2>
<section id="download-nei-data" class="level3">
<h3 class="anchored" data-anchor-id="download-nei-data">Download NEI data</h3>
<p>Students will draw from two publicly available datasets for this assignment: NEI and TRI. The <a href="https://www.epa.gov/air-emissions-inventories/national-emissions-inventory-nei">National Emissions Inventory</a> (NEI) is a comprehensive and detailed estimate of air emissions of criteria pollutants, criteria precursors, and hazardous air pollutants from air emissions sources. The NEI is released every three years based primarily upon data provided by State, Local, and Tribal air agencies for sources in their jurisdictions and supplemented by data developed by the US EPA. The NEI is built using the Emissions Inventory System (EIS) first to collect the data from State, Local, and Tribal air agencies and then to blend that data with other data sources. Use the following code to download and subset the latest NEI data to California.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># National Emissions Inventory (zip format)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">"https://gaftp.epa.gov/air/nei/2020/data_summaries/Facility%20Level%20by%20Pollutant.zip"</span>,temp)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>NEI_2020_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">unz</span>(temp, <span class="st">"emis_sum_fac_23959.csv"</span>))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(temp)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># format NEI data</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># filter sulfur dioxide releases in California</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>NEI_2020_form <span class="ot">&lt;-</span> NEI_2020_raw <span class="sc">%&gt;%</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_name =</span> <span class="st">`</span><span class="at">company name</span><span class="st">`</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">site_name =</span> <span class="st">`</span><span class="at">site name</span><span class="st">`</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_street =</span> address,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_city =</span> city,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_state =</span> <span class="st">`</span><span class="at">postal abbreviation</span><span class="st">`</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_zip =</span> <span class="st">`</span><span class="at">zip code</span><span class="st">`</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">naics_code =</span> <span class="st">`</span><span class="at">primary naics code</span><span class="st">`</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="st">`</span><span class="at">site latitude</span><span class="st">`</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="st">`</span><span class="at">site longitude</span><span class="st">`</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">pollutant_code =</span> <span class="st">`</span><span class="at">pollutant code</span><span class="st">`</span>,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">pollutant_desc =</span> <span class="st">`</span><span class="at">pollutant desc</span><span class="st">`</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">pollutant_type =</span> <span class="st">`</span><span class="at">pollutant type(s)</span><span class="st">`</span>,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">emissions_uom =</span> <span class="st">`</span><span class="at">emissions uom</span><span class="st">`</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">emissions =</span> <span class="st">`</span><span class="at">total emissions</span><span class="st">`</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    fac_name,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    site_name,</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    fac_street,</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    fac_city,</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    fac_state,</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    fac_zip,</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    naics_code,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    latitude,</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    longitude,</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    pollutant_code,</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    pollutant_desc,</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    pollutant_type,</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    emissions_uom,</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    emissions</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fac_state <span class="sc">==</span> <span class="st">"CA"</span>,</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>         pollutant_code <span class="sc">==</span> <span class="st">"SO2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="download-tri-data" class="level3">
<h3 class="anchored" data-anchor-id="download-tri-data">Download TRI data</h3>
<p>The US EPA’s <a href="https://www.epa.gov/toxics-release-inventory-tri-program/what-toxics-release-inventory">Toxics Release Inventory</a> (TRI) program tracks the management of certain toxic chemicals that pose a threat to human health and the environment. Large US facilities (i.e., those emitting 10 tons or more per year) in different industry sectors must report annually how much of each chemical is released to the environment and/or managed through recycling, energy recovery and treatment. Data containing the 100 most-used data fields from the TRI Reporting Form R and Form A Certification Statement are made available in various formats on the <a href="https://www.epa.gov/toxics-release-inventory-tri-program/tri-basic-data-files-calendar-years-1987-present">TRI Basic Data web page</a> for the 2021 reporting year. The data can be downloaded for the entire US or by state. <a href="https://www.epa.gov/system/files/documents/2022-10/TRI_Basic_Data_File_Documentation_RY2021_102522.pdf">Reference information for this file in PDF format</a> is available on the TRI website. Use the following code to download and subset the latest TRI data to California.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>TRI_2021_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://data.epa.gov/efservice/downloads/tri/mv_tri_basic_download/2021_US/csv"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># format TRI data</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># filter data stack air releases in California</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>TRI_2021_form <span class="ot">&lt;-</span> TRI_2021_raw <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="dv">1</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_name =</span> <span class="dv">4</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_street =</span> <span class="dv">5</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_city =</span> <span class="dv">6</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_county =</span> <span class="dv">7</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_state =</span> <span class="dv">8</span>,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_zip =</span> <span class="dv">9</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="dv">12</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="dv">13</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">parent_co =</span> <span class="dv">15</span>,</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">sector_code =</span> <span class="dv">19</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">sector_name =</span> <span class="dv">20</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">chemical =</span> <span class="dv">34</span>,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">casno =</span> <span class="dv">37</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">srsid =</span> <span class="dv">38</span>,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">caa_chemical =</span> <span class="dv">39</span>,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">carcinogen =</span> <span class="dv">43</span>,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">pfas =</span> <span class="dv">45</span>,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">emissions_uom =</span> <span class="dv">47</span>,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">fugitive_air =</span> <span class="dv">48</span>,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">stack_air =</span> <span class="dv">49</span>,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">water =</span> <span class="dv">50</span>,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">underground =</span> <span class="dv">51</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    year,</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    fac_name,</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    fac_street,</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    fac_city,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    fac_county,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    fac_state,</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    fac_zip,</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    latitude,</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    longitude,</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    parent_co,</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    sector_code,</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    sector_name,</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    chemical,</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    casno,</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    srsid,</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    caa_chemical,</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    carcinogen,</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    pfas,</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    emissions_uom,</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    fugitive_air,</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    stack_air,</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    water,</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    underground</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fac_state <span class="sc">==</span> <span class="st">"CA"</span>,</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>         stack_air <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="download-rsei-data" class="level3">
<h3 class="anchored" data-anchor-id="download-rsei-data">Download RSEI data</h3>
<p>EPA’s Risk-Screening Environmental Indicators (RSEI) model helps policy makers, researchers, and communities explore data on releases of toxic substances from industrial and federal facilities. The model considers the fate and transport of chemicals through the environment, each chemical’s relative toxicity, and potential human exposure. When combined with the total releases of chemicals by location, RSEI model results can be used to help identify locations of toxic hot spots, monitor potential human health impacts over time, prioritize investigative work and prioritize the allocation of agency resources, more generally. Use the following code to import the latest RSEI toxicity weights from the course GitHub, then join RSEI toxicity weights to the TRI data. <em>Note that the toxicity weights are reduced by a factor of 10^5 so that dispersion values can be more easily computed using AERMOD.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RSEI data (Excel format)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This reference dataset is reguarly updated at https://www.epa.gov/rsei/rsei-toxicity-data-and-calculations</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>RSEI_v2311_raw <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="st">"https://github.com/justenvirons/pedagogy/raw/main/GEO346_2023_FallQuarter/Exercise_02/data/toxicity_data_rsei_v2311.xlsx"</span>, <span class="at">sheet=</span><span class="dv">2</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>RSEI_v2311_form <span class="ot">&lt;-</span> RSEI_v2311_raw <span class="sc">%&gt;%</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">casno =</span> CASStandard) <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">itw =</span> <span class="fu">as.numeric</span>(ITW)) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(casno, </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>         itw)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Join TRI with RSEI inhalation toxicity weights (ITW)</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop coordinates with NA values</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>TRI_2021_form_wtd <span class="ot">&lt;-</span> TRI_2021_form <span class="sc">%&gt;%</span> </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(RSEI_v2311_form, <span class="at">by =</span> <span class="st">"casno"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stack_air_itw =</span> stack_air <span class="sc">*</span> itw<span class="sc">/</span><span class="dv">1000000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(stack_air_itw) <span class="sc">%&gt;%</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>itw) <span class="sc">%&gt;%</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(<span class="fu">c</span>(latitude,longitude))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learn more about RSEI results
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Watch the below video to learn more about the results produced by EPA’s Risk-Screening Environmental Indicators (RSEI) model.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/U08DBEIf7x4" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</div>
</div>
</div>
</section>
<section id="create-and-write-shapefiles" class="level3">
<h3 class="anchored" data-anchor-id="create-and-write-shapefiles">Create and write shapefiles</h3>
<p>Modify the below code to save the NEI and TRI air pollution tables as shapefiles into your working directory, perhaps in the “data” folder (e.g., “data/TRI_2021.shp” and “data/NEI_2020.shp”). If you are choosing to examine an area located within northern California, use UTM 10N (EPSG: 26910) or UTM 11N (EPSG: 26911) if your study area is in southern California. See a general map of the UTM zones for the contiguous United States below.</p>
<p><img src="images/fig44.gif" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(TRI_2021_form_wtd_geom)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>TRI_2021_form_wtd_geom <span class="ot">&lt;-</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(TRI_2021_form_wtd,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs =</span> <span class="dv">4269</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">26911</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">st_coordinates</span>(.))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create basic plot of TRI facilities</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(TRI_2021_form_wtd_geom[<span class="st">'srsid'</span>])</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># write TRI data to shapefile</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(TRI_2021_form_wtd_geom,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>         <span class="st">"enter working directory and desired file name"</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>NEI_2020_form_geom <span class="ot">&lt;-</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(NEI_2020_form,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs =</span> <span class="dv">4269</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">26911</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">st_coordinates</span>(.)) <span class="co"># or crs = 26910 if in northern California</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co"># create basic plot of NEI facilities</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(NEI_2020_form_wtd_geom[<span class="st">'srsid'</span>])</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co"># write NEI data to shapefile</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(NEI_2020_form_geom,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>         <span class="st">"enter working directory and desired file name"</span>,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="step-3.-create-and-add-data-to-arcgis-pro-project" class="level2">
<h2 class="anchored" data-anchor-id="step-3.-create-and-add-data-to-arcgis-pro-project">Step 3. Create and add data to ArcGIS Pro project</h2>
<section id="add-nei-and-tri-to-arcgis-pro" class="level3">
<h3 class="anchored" data-anchor-id="add-nei-and-tri-to-arcgis-pro">Add NEI and TRI to ArcGIS Pro</h3>
<p>Create a new ArcGIS Pro project on your computer under the maps directory in your R project folder. In your ArcGIS Pro map project, under the “Map” menu, click the “Add Data” option on the toolbar and navigate to the directory where you exported the NEI and TRI datasets. You may need to click the “Connect to Folder” and navigate to your project directory. Select all three of the files and add to the map frame. They should draw automatically and appear in the table of contents.</p>
</section>
<section id="download-and-add-air-basin-boundaries-to-arcgis-pro" class="level3">
<h3 class="anchored" data-anchor-id="download-and-add-air-basin-boundaries-to-arcgis-pro">Download and add air basin boundaries to ArcGIS Pro</h3>
<p>Use the following code to download the <a href="https://ww3.arb.ca.gov/ei/gislib/boundaries/ca_co_ab_dis.zip">California county, air basin and air district boundary file</a> from the <a href="https://ww2.arb.ca.gov/geographical-information-system-gis-library">California Air Resources Board (CARB) GIS Library web page</a> and extract files to your “data” directory. The air basin boundaries will be helpful to identify the entity that provides AERMOD-ready meteorological data near your facility given that AERMOD requires such data to estimate the geographic distribution of releases over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">"https://ww3.arb.ca.gov/ei/gislib/boundaries/ca_co_ab_dis.zip"</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>              temp)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(<span class="at">zipfile =</span> temp,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">exdir =</span> <span class="st">"data"</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="download-meteorological-data" class="level3">
<h3 class="anchored" data-anchor-id="download-meteorological-data">Download meteorological data</h3>
<p>The California Air Resources Board (CARB) makes available <a href="https://ww2.arb.ca.gov/resources/documents/harp-aermod-meteorological-files">AERMOD-ready meteorological data for 28 select weather stations throughout the state</a> while the various air quality districts make available similarly formatted data for weather stations within their respective jurisdictions. Links to the district-specific weather station and data are also available via district links on the <a href="https://ww2.arb.ca.gov/resources/documents/harp-aermod-meteorological-files">ARB meteorological data webpage</a>. Save the appropriate meteorological data in your “aermod” folder.</p>
</section>
</section>
<section id="step-4.-create-and-center-study-area" class="level2">
<h2 class="anchored" data-anchor-id="step-4.-create-and-center-study-area">Step 4. Create and center study area</h2>
<p>You are tasked with estimating emissions from an existing facility. You will need to create a custom and spatially explicit study area centered on your facility of interest in order to run the needed calculations. Create your custom study area by doing the following:</p>
<ul>
<li><p>First, identify a single facility in the NEI facilities shapefile that emits considerable amounts of sulfur dioxide (SO2), perhaps over 100 tons per year. Zoom to the facility in ArcGIS Pro.</p></li>
<li><p>Under the “View” menu, click the “Catalog Pane” option to view project contents. Navigate to your project folder and right-click on the “data” directory to create a new shapefile. With your project directory selected, open the File menu and select the “New/Shapefile” option. In the “Create Feature Class” dialog box, give your polygonal shapefile an appropriate name (e.g., studyarea). Be sure the output coordinate system corresponds with the other shapefiles in your map frame (i.e., UTM Zone 10N, NAD 1983). When finished, add the new shapefile to the map.</p>
<p><img src="images/paste-D249D986.png" class="img-fluid" style="width:3in"></p></li>
<li><p>In the “Edit” menu, click “Create” to begin delineating the study area polygon. In the “Create Features” dialog, use the square template to construct the polygon. With the pencil tool activated, create a 10km by 10km square by clicking the map to create the initial vertex. Don’t be concerned about the specific location of the initial vertex (and study area) at this time. While still editing, right-click inside the map frame and select the “Direction/Size” option to make visible the associated dialog box. Enter “0” for direction and 10km for both length and width. When finished entering the dimensions click the Enter key on your keyboard to create the new feature.</p>
<p><img src="images/paste-F8F29155.png" class="img-fluid" style="width:1.5in"></p></li>
<li><p>Lastly, center your study area so that the facility you identified is located in the (approximate) center. Do this by clicking on the “Edit” menu and selecting the study area polygon. Use the “Move” tool to position the polygon in the desired location. Save your edits. Under the “Share” menu, click “Capture to Clipboard” and paste the NEI facilities map into the appropriate PowerPoint slide.</p>
<p><img src="images/paste-8B95D98A.png" class="img-fluid" style="width:2in"></p></li>
</ul>
</section>
<section id="step-5.-model-single-facility-pollutant-so2-concentrations-using-aermod" class="level2">
<h2 class="anchored" data-anchor-id="step-5.-model-single-facility-pollutant-so2-concentrations-using-aermod">Step 5. Model single facility pollutant (SO2) concentrations using AERMOD</h2>
<p>In this part of the exercise you will analyze the concentrations of sulfur dioxide emitted from the facility you selected within your study area. <em>Note that you may need to run the AERMOD executable locally on your computer if Virtual Lab returns an error.</em></p>
<section id="customize-parameters-in-the-aermod-input-file-aermod.inp" class="level3">
<h3 class="anchored" data-anchor-id="customize-parameters-in-the-aermod-input-file-aermod.inp">Customize parameters in the AERMOD input file (AERMOD.INP)</h3>
<p>Now you will use AERMOD to model emissions from the facility you selected.</p>
<ul>
<li><p>Using a text editor (such as notepad), open the AERMOD.INP (i.e., runstream) file located in the aermod folder. You will need to modify parameters in this file to estimate geographic distributions of pollutant concentrations from your selected facility. The runstream file is divided into five functional “pathways.” These pathways are identified by a two-character pathway ID placed at the beginning of each runstream image. The start and end of each pathway in the code are bookmarked with “STARTING” and “ENDING” statements. The pathways and the order in which they are specified in the runstream are as follows:</p></li>
<li><p>CO - for specifying overall job COntrol options;</p></li>
<li><p>SO - for specifying pollution SOurce information;</p></li>
<li><p>RE - for specifying REceptor information;</p></li>
<li><p>ME - for specifying MEteorology information;</p></li>
<li><p>EV - for specifiying EVent processing;</p></li>
<li><p>OU - for specifying OUtput options.</p></li>
</ul>
<p>For this exercise, you will be using all but the event (EV) pathway. The default contents and parameters of the AERMOD runstream file you extracted to your aermod directory are shown below.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode default code-with-copy"><code class="sourceCode default"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>CO STARTING</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>CO TITLEONE SINGLEFAC</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>CO MODELOPT CONC FLAT</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>CO AVERTIME 1 3</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>CO POLLUTID SO2</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>CO RUNORNOT RUN</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>CO ERRORFIL ERRORS.OUT</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>CO FINISHED</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>SO STARTING</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>SO LOCATION FAC1 POINT 385362 3741767 0.0</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>SO SRCPARAM FAC1 9.13 76. 353. 5. 3.0</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>SO SRCGROUP ALL</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>SO FINISHED</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>RE STARTING</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>   GRIDCART NET1 STA</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>                XYINC 380239 50 200. 3736617 50 200.</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>   GRIDCART NET1 END</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>RE FINISHED</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>ME STARTING</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>ME SURFFILE KLGB_v9.SFC</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>ME PROFFILE KLGB_v9.PFL</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>ME PROFBASE 0.0 METERS</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>ME SURFDATA 23129 2016</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>ME UAIRDATA 3190 2016</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>ME FINISHED</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>OU STARTING</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>OU PLOTFILE 1 ALL FIRST 1HRMAX1.PLT</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>OU PLOTFILE 3 ALL FIRST 3HRMAX1.PLT</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>OU FINISHED</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>The control pathway (CO) in the runstream code specifies a run entitled SINGLEFAC which calculates average maximum concentrations of a pollutant (here specified as POLLUTID SO2) over 1- and 3-hour periods (AVERTIME 1 3). Concentrations will be calculated in micrograms per cubic meter (µg/m^3) based on an assumed flat terrain (FLAT). Any errors will be saved into an error file named ERRORS.OUT. <em>The default parameters can be used in the control pathway.</em></li>
</ul>
<pre><code>CO STARTING
CO TITLEONE SINGLEFAC
CO MODELOPT CONC FLAT
CO AVERTIME 1 3
CO POLLUTID SO2
CO RUNORNOT RUN
CO ERRORFIL ERRORS.OUT
CO FINISHED</code></pre>
<ul>
<li>The source pathway (SO) code establishes sources of pollution. For this exercise, you will specify a single point source of pollution; your selected facility from the National Emissions Inventory dataset. In the example code, the location (SO LOCATION) coordinates (X and Y) reflect those for a facility in Long Beach, California and the source parameters (SO SRCPARAM) specify the rate of SO2 emissions from the selected facility in the proper units (grams per second), assuming a steady state of releases from the facility over a one-year period. <em>Change these parameters to reflect those of the facility you selected.</em> The <a href="https://github.com/justenvirons/pedagogy/raw/main/GEO346_2022_FallQuarter/Exercise_02/aermod/AERMODFormatting.xls">AERMOD_Formatting.xlsx</a> spreadsheet extracted to your aermod folder provides tools to help with formatting the SO LOCATION AND SO SRCPARAM parameters including converting tons per year to grams per second (g/s) using the following formula:</li>
</ul>
<p><span class="math display">\[
g/s = (tons/year\*2000 pounds/year\*453.59237 grams/pound)/(365 days/year \* 24 hrs/day \* 60 minutes/hour \* 60 seconds/minute))
\]</span> Use the default (i.e., existing) settings for the release height, stack gas exit temperature, stack gas exit velocity, and stack diameter (e.g., 76. 353. 5. 3.0) for the facility if not known.</p>
<pre><code>SO STARTING
SO LOCATION FAC1 POINT 385362 3741767 0.0
SO SRCPARAM FAC1 9.13 76. 353. 5. 3.0
SO SRCGROUP ALL
SO FINISHED</code></pre>
<ul>
<li>The receptor (or RE) pathway specifies a Cartesian grid (GRIDCART) with 50 nodes spaced every 200 meters in the x direction and the same in the y direction beginning at the southwest corner of the study area. The example code designates the first coordinate, <em>380239</em>, as the location of lower left vertex of the study area in the x direction and the second coordinate, <em>3736617</em>, as the location of the lower left vertex of the study area in the y direction in UTM coordinates. The entire grid spans 10 km by 10 km. You can again use the <a href="https://github.com/justenvirons/pedagogy/blob/main/GEO346_2023_FallQuarter/Exercise_02/aermod/AERMODFormatting.xls">AERMODFormatting.xlsx</a> spreadsheet to format the GRIDCART XYINC parameter in the AERMOD.INP file. <em>Change the coordinates in the receptor pathway to match those of the southwest corner of your study area.</em></li>
</ul>
<pre><code>RE STARTING
   GRIDCART NET1 STA
                XYINC 380239 50 200. 3736617 50 200.
   GRIDCART NET1 END
RE FINISHED</code></pre>
<ul>
<li>Edit the meteorological (ME) pathway, so that it references the surface (SURFILE) and upper air (PROFFILE) meteorological files for the meteorological station nearest your study area. The example code references the associated files for the Long Beach Municipal Airport (KLGB_v9.SFC and KLGB_v9.PFL). Also note the codes for the surface (SURFDATA) and upper air (UAIRDATA) meteorological stations used in your data and the year of the data being processed. For example, in the sample AERMOD.INP file, the surface meteorological station code is “23129” and the upper air station code is “3190” and the meteorological data span through 2016. These identification codes can be found in the header of the *.SFC meteorological file. The meteorological pathway also allows users to specify discrete start and end dates. In this example, the STARTEND parameter is set to a single year of meteorological data (1/1/2016 to 12/31/2016). These dates may need to be changed depending on the year of your meteorological data.</li>
</ul>
<pre><code>ME STARTING
ME SURFFILE KLGB_v9.SFC
ME PROFFILE KLGB_v9.PFL
ME PROFBASE 0.0 METERS
ME SURFDATA 23129 2012
ME UAIRDATA 3190 2012
ME STARTEND 2016 01 01 2016 12 31
ME FINISHED</code></pre>
<ul>
<li>Lastly, set the output (OU) pathway to create four plot files, with each representing key concentrations over given periods of time. The default input file calculates maximum concentrations averaged over one- and three-hour periods. Concentrations will be estimated for each of the 2,500 receptors in your study area. The default file names for the output plot files in the OU parameters are 1HRMAX.PLT (for the one-hour concentrations) and 3HRMAX.PLT (for the three-hour concentrations).</li>
</ul>
<pre><code>OU STARTING
OU PLOTFILE 1 ALL FIRST 1HRMAX1.PLT
OU PLOTFILE 3 ALL FIRST 3HRMAX1.PLT
OU FINISHED</code></pre>
</section>
<section id="run-the-aermod-model-with-custom-parameters" class="level3">
<h3 class="anchored" data-anchor-id="run-the-aermod-model-with-custom-parameters">Run the AERMOD model with custom parameters</h3>
<p>Once you have changed the parameters in the AERMOD.INP file to match your facility, you are ready to run the newly specified model using AERMOD. To run the model, navigate to the directory where aermod.inp, aermod.exe and the associated meteorological files are located. Double-click the aermod.exe executable file (or drag and release aermod.inp over aermod.exe). Allow AERMOD to cycle through all the days represented in your meteorological data (e.g., 365 days for each year). If you receive an error, check the sources of the error by reading the ERROR.OUT file in notepad or other text editor to review.</p>
</section>
<section id="reformat-model-output-data-and-export-as-ascii-grid" class="level3">
<h3 class="anchored" data-anchor-id="reformat-model-output-data-and-export-as-ascii-grid">Reformat model output data and export as ASCII grid</h3>
<p>Once AERMOD has completed the procedure without errors (i.e., if the *.PLT files have been created successfully), you will need to reformat the data in the plot files so that they are readable in ArcGIS Pro. Use the following code to simplify and format the data into five variables, (x for longitude, y for latitude, value for max concentrations, period, date). Use the code to convert the data frame into an ASCII grid and export the grid into your project data folder for import into ArcGIS Pro.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reformat 1-hour AERMOD fixed width PLT output as R data frame </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>emissions_1hr_df <span class="ot">&lt;-</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.fwf</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">"aermod/1HRMAX1.PLT"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">skip =</span> <span class="dv">8</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">15</span>, <span class="dv">15</span>, <span class="dv">28</span>, <span class="dv">4</span>, <span class="dv">32</span>, <span class="dv">8</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> V1,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> V2,</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> V3,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">period =</span> V5,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_orig =</span> V7</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">substr</span>(date_orig, <span class="dv">1</span>, <span class="dv">6</span>), <span class="st">"%y%m%d"</span>),</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">hour =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(date_orig, <span class="dv">7</span>, <span class="dv">8</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>date_orig)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co"># create histogram of 1-hour max concentrations</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(emissions_1hr_df, <span class="fu">aes</span>(<span class="at">x=</span>value)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"gray40"</span>, <span class="at">fill=</span><span class="st">"gray80"</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co"># create raster grid of 1-hour max concentrations from dataframe, with resolution of 200m</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>emissions_1hr_grid <span class="ot">&lt;-</span> <span class="fu">rasterFromXYZ</span>(emissions_1hr_df, <span class="at">res=</span><span class="dv">200</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co"># set projection and datum of grid in PROJ.4 format</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="fu">projection</span>(emissions_1hr_grid) <span class="ot">=</span> <span class="fu">CRS</span>(<span class="st">"+proj=utm +zone=11 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"</span>)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co"># plot raster grid of 1-hour max concentrations in R</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(emissions_1hr_grid<span class="sc">$</span>value)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co"># export raster grid of 1-hour max concentrations as ASCII file</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>  emissions_1hr<span class="sc">$</span>value,</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"aermod/emissions_1hr.asc"</span>,</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">c</span>(<span class="st">'TFW=YES'</span>)</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="co"># reformat 3-hour AERMOD fixed width PLT output as R data frame </span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>emissions_3hr_df <span class="ot">&lt;-</span> <span class="fu">read.fwf</span>(<span class="at">file =</span> <span class="st">"aermod/3HRMAX1.PLT"</span>,</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>                 <span class="at">skip =</span> <span class="dv">8</span>,</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>                 <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">15</span>,<span class="dv">15</span>,<span class="dv">15</span>,<span class="dv">28</span>,<span class="dv">4</span>,<span class="dv">32</span>,<span class="dv">8</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">x =</span> V1,</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> V2,</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>         <span class="at">value =</span> V3,</span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>         <span class="at">period =</span> V5,</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>         <span class="at">date_orig =</span> V7) <span class="sc">%&gt;%</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">substr</span>(date_orig,<span class="dv">1</span>,<span class="dv">6</span>),<span class="st">"%y%m%d"</span>),</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">hour =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(date_orig,<span class="dv">7</span>,<span class="dv">8</span>)))</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of 3-hour max concentrations</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(emissions_3hr_df, <span class="fu">aes</span>(<span class="at">x=</span>maxconc)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"gray40"</span>, <span class="at">fill=</span><span class="st">"gray80"</span>)</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a><span class="co"># create raster grid of 3-hour max concentrations from dataframe, with resolution of 200m</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>emissions_3hr <span class="ot">&lt;-</span> <span class="fu">rasterFromXYZ</span>(emissions_3hr_df, <span class="at">res=</span><span class="dv">200</span>)</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(emissions_3hr<span class="sc">$</span>value)</span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a><span class="co"># set projection and datum in PROJ.4 format</span></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a><span class="fu">projection</span>(emissions_3hr) <span class="ot">=</span> <span class="fu">CRS</span>(<span class="st">"+proj=utm +zone=11 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"</span>)</span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a><span class="co"># create preliminary plot of 3-hour max concentrations</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(emissions_3hr<span class="sc">$</span>value)</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a><span class="co"># export raster grid of 3-hour max concentrations</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(</span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>  emissions_1hr<span class="sc">$</span>value,</span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"aermod/emissions_3hr.asc"</span>,</span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">c</span>(<span class="st">'TFW=YES'</span>)</span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="step-6.-create-final-maps-and-figures-in-arcgis-pro" class="level2">
<h2 class="anchored" data-anchor-id="step-6.-create-final-maps-and-figures-in-arcgis-pro">Step 6. Create final maps and figures in ArcGIS Pro</h2>
<p>Return to ArcGIS Pro and import the ASCII grids into your existing map via the Catalog Pane or Add Data menu option. Create a custom layout with standard map elements (i.e., north arrow, scale bar and data source, etc.) Modify the symbology for the pollution concentration grids as desired. Copy the 1-hour and 3-hour single facility max concentrations maps and histograms into the appropriate PowerPoint slide. Lastly, copy the statistics for the two grids into the summary table in PowerPoint. Summarize your results. In your write-up, consider the degree to which the single facility you modeled contributes to the overall pollution burden within your study area. Also consider any limitations or concerns you may have about the pollution estimates (e.g., what is excluded from the model).</p>
</section>
<section id="cumulative-emissions-optional" class="level2">
<h2 class="anchored" data-anchor-id="cumulative-emissions-optional">Cumulative emissions <em>(optional)</em></h2>
<p>Add additional facilities to the SOurce pathway to calculate SO2 emissions for multiple facilities within and proximate to your study area. For the multiple facilities (or cumulative analysis), begin by selecting all facilities inside and within one kilometer of your study area (hint: use the buffer distance option under the “select by location” option under the “Select” menu). Open the attribute table and copy the facility information into Excel. Use the provided AERMODFormatting.xlsx spreadsheet to format source location and source parameter specifications for the new AERMOD facilities. Re-run the AERMOD.INP with updated facility information and plot the results. Compare the modeled pollutant concentrations in the cumulative model to the regulatory reference concentrations (<a href="https://www.epa.gov/criteria-air-pollutants/naaqs-table">US EPA national air quality standards</a>. Do the concentrations exceed the reference concentrations?</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Comparison concentrations
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Note that you will need to <a href="https://www.breeze-technologies.de/blog/air-pollution-how-to-convert-between-mgm3-%C2%B5gm3-ppm-ppb/">convert the ppb and ppm standards to ug/m^3</a> in order to compare with AERMOD output. The 1-hour average primary standard 75 ppb is equal to 196.5 ug/m^3 and the 3-hour average 0.5 ppm secondary standard is equal to 1,310 ug/m^3</p>
</div>
</div>
</div>
</section>
<section id="model-seasonal-variation-in-toxic-air-concentrations-optional" class="level2">
<h2 class="anchored" data-anchor-id="model-seasonal-variation-in-toxic-air-concentrations-optional">Model seasonal variation in toxic air concentrations <em>(optional)</em></h2>
<p>Use the TRI inhalation toxicity weights to model toxic air releases within your study area from large, industrial facilities represented in the latest (2020) EPA’s Toxics Release Inventory or TRI report. The TRI reports emissions by facility for each of the 650 toxics and toxic compounds. Given that every chemical has a different dose-response curve or, more simply, a different toxicological profile, use the inhalation toxicity weighted factors (ITW) from EPA’s Risk-Screening Environmental Indicators (RSEI) to model pollution burden. Change the STARTEND parameter in the MEteorological pathway to create four separate maps, one for each season. Describe seasonal variations in emissions burden across your study area.</p>
<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-ala2023" class="csl-entry" role="listitem">
ALA. 2023. <span>“State of the <span>Air</span> 2023.”</span> <span>Chicago, IL</span>: <span>American Lung Association</span>.
</div>
<div id="ref-ard2020" class="csl-entry" role="listitem">
Ard, Kerry, and Clair Bullock. 2020. <span>“Chapter 12 - <span>Concentrating</span> Risk? <span>The</span> Geographic Concentration of Health Risk from Industrial Air Toxics Across <span>America</span>.”</span> In <em>Spatiotemporal <span>Analysis</span> of <span>Air Pollution</span> and <span>Its Application</span> in <span>Public Health</span></em>, edited by Lixin Li, Xiaolu Zhou, and Weitian Tong, 277–92. <span>Elsevier</span>. <a href="https://doi.org/10.1016/B978-0-12-815822-7.00012-1">https://doi.org/10.1016/B978-0-12-815822-7.00012-1</a>.
</div>
<div id="ref-usepa2014" class="csl-entry" role="listitem">
EPA, US. 2014. <span>“<span>NAAQS Table</span>.”</span> Other {{Policies}} and {{Guidance}}. https://www.epa.gov/criteria-air-pollutants/naaqs-table.
</div>
<div id="ref-landrigan2017" class="csl-entry" role="listitem">
Landrigan, Philip J. 2017. <span>“Air Pollution and Health.”</span> <em>The Lancet Public Health</em> 2 (1): e4–5. <a href="https://doi.org/10.1016/S2468-2667(16)30023-8">https://doi.org/10.1016/S2468-2667(16)30023-8</a>.
</div>
<div id="ref-lejano2006b" class="csl-entry" role="listitem">
Lejano, Raul P., and C. Scott Smith. 2006. <span>“Incompatible <span>Land Uses</span> and the <span>Topology</span> of <span>Cumulative Risk</span>.”</span> <em>Environmental Management</em> 37 (2): 230–46.
</div>
<div id="ref-usepa2013" class="csl-entry" role="listitem">
US EPA, OP. 2013. <span>“Summary of the <span>Clean Air Act</span>.”</span> Overviews and {{Factsheets}}. https://www.epa.gov/laws-regulations/summary-clean-air-act.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb15" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "GEO 3/446 Exercise #2"</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Air Dispersion Modeling and Visualization"</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> C. Scott Smith, PhD AICP (Instructor)</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="an">email:</span><span class="co"> c.scott.smith@depaul.edu</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r format(Sys.time(), '%d %B %Y')`"</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># output-location: "../../../docs"</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">    echo: true</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">    eval: false</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">    warning: false</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: [flatly, "../../styles.scss"]</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co">    reference-location: document</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> "../../references.bib"</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="fu">## Background</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>Air quality (both outdoor/ambient and indoor/household) is associated with a broad range of disease outcomes (e.g., asthma, cancer) and is globally responsible for millions of deaths each year <span class="co">[</span><span class="ot">@landrigan2017</span><span class="co">]</span>. The Clean Air Act (CAA) is the comprehensive US federal law that regulates air emissions from stationary and mobile sources<span class="co">[</span><span class="ot">@usepa2013</span><span class="co">]</span>. Among other things, the Act authorizes the US Environmental Protection Agency (EPA) to establish National Ambient Air Quality Standards (NAAQS) <span class="co">[</span><span class="ot">@usepa2014</span><span class="co">]</span> designed to protect public health from six outdoor air pollutants: particulate matter, ozone, nitrogen oxides, sulfur dioxide, carbon monoxide and lead ("criteria" pollutants). The EPA is also required to identify and regulate emissions of hazardous air pollutants (HAPs) which, since 1990, includes <span class="co">[</span><span class="ot">188 pollutants</span><span class="co">](https://www.epa.gov/haps/initial-list-hazardous-air-pollutants-modifications)</span>.</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="false"}</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="fu">## Additional reading on the effects of air pollution on health</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>Each year, the American Lung Association publishes its annual <span class="co">[</span><span class="ot">State of the Air report</span><span class="co">](https://www.lung.org/research/sota)</span> <span class="co">[</span><span class="ot">@ala2023</span><span class="co">]</span>which examines two of the most widespread and dangerous pollutants from this group, particulate matter and ozone. Other readings concerning the environmental justice implications of land use planning and toxic air pollution include "Incompatible Land Uses and the Topology of Cumulative Risk" <span class="co">[</span><span class="ot">@lejano2006b</span><span class="co">]</span> and "Concentrating risk? The geographic concentration of health risk from industrial air toxics across America" <span class="co">[</span><span class="ot">@ard2020</span><span class="co">]</span>.</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>This exercise involves the evaluation of ambient air concentrations of criteria and toxic pollutants within a student-specified area in California. Students will model concentrations using regularly updated, facility-level emissions made available from the EPA (i.e., <span class="co">[</span><span class="ot">AirData National Emmissions Inventory</span><span class="co">](https://www.epa.gov/air-emissions-inventories/national-emissions-inventory-nei)</span> and <span class="co">[</span><span class="ot">Toxic Release Inventory</span><span class="co">](https://www.epa.gov/toxics-release-inventory-tri-program)</span>), hourly meteorological data from local weather stations and <span class="co">[</span><span class="ot">AERMOD</span><span class="co">](https://www.epa.gov/scram/air-quality-dispersion-modeling-preferred-and-recommended-models)</span>, an air dispersion model developed by the EPA.</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>AERMOD is presently the model recommended for US government agencies to estimate pollutant concentrations from stationary (and mobile) sources in urban areas. AERMOD allows for the specification of multiple sources, facility-specific release patterns (it also allows for specification of uneven terrain and effects of nearby building downwash, but we won't take advantage of these functions in this exercise). The model requires that hourly wind patterns (direction and speed) and temperature data be input. Near-field models like AERMOD differ from far-field models in that the former are able to capture initial mixing phenomena that occur just after the plume leaves the source (such as a smokestack). The AERMOD near-field model is best suited for study areas no greater than 50km by 50km. For this exercise, students will model a custom study area with dimensions 10km by 10km.</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>::: {layout-ncol="2"}</span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/fisk.png)</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/emissions.png)</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>Students will save maps, tables and summaries of spatial analyses in a <span class="co">[</span><span class="ot">PowerPoint presentation</span><span class="co">](https://github.com/justenvirons/pedagogy/blob/main/GEO346_2023_FallQuarter/Exercise_02/exercise02-template.pptx)</span> (or, optionally, a document created with Quarto markdown in R) to be submitted via the course web page. Students are welcome to work collectively with classmates to overcome obstacles experienced while completing the required tasks, although all submissions will be unique given that students will choose their own study areas that have different distributions of pollution sources (and therefore different patterns of air pollutant concentrations). Of course the interpretations will also be your own. As in all assignments for this class, you will be asked to not only produce attractive (strive for cartographic perfection!) and meaningful maps, but also describe patterns presented within them. The three sections below step you through the process to create the above deliverable. (For some of the more complicated procedures, online videos will be made available on the course D2L under the Exercise #2 content folder.)</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 1. Create and prepare a new R project</span></span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>In RStudio, create a project within a new directory (e.g., GEO336/exercise_02) of your general course folder. Here you will save files related to exercise #2. Create the following folders within the new exercise-specific directory, "aermod", "data", "maps" and "scripts".</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a><span class="fu">### Install and activate R packages</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>Use the following code to activate the packages required to download and transform data needed for the exercise.</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Install and activate R packages</span></span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(c("dplyr", "tidyverse", "openxlsx","sf", "sp")) if necessary</span></span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-61"><a href="#cb15-61" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># data wrangling with pipe syntax</span></span>
<span id="cb15-62"><a href="#cb15-62" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># data wrangling</span></span>
<span id="cb15-63"><a href="#cb15-63" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openxlsx) <span class="co"># use for importing data in Excel format</span></span>
<span id="cb15-64"><a href="#cb15-64" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># simple features data package </span></span>
<span id="cb15-65"><a href="#cb15-65" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp) <span class="co"># spatial data package</span></span>
<span id="cb15-66"><a href="#cb15-66" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># creating plots</span></span>
<span id="cb15-67"><a href="#cb15-67" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych) <span class="co"># calculating summary statistics</span></span>
<span id="cb15-68"><a href="#cb15-68" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster) <span class="co"># create raster dataset</span></span>
<span id="cb15-69"><a href="#cb15-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-70"><a href="#cb15-70" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">999</span>, <span class="at">digits =</span> <span class="dv">2</span>) <span class="co"># format output for data tables</span></span>
<span id="cb15-71"><a href="#cb15-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-72"><a href="#cb15-72" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-73"><a href="#cb15-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-74"><a href="#cb15-74" aria-hidden="true" tabindex="-1"></a><span class="fu">### Create data processing script in R</span></span>
<span id="cb15-75"><a href="#cb15-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-76"><a href="#cb15-76" aria-hidden="true" tabindex="-1"></a>In RStudio, create a new script file for storing data processing code relevant to this exercise. Create the blank script file by first navigating to the "scripts" directory you created in your project working directory and clicking "New Blank File" in the files pane. Name the script something intuitive (e.g., "exercise02.R").</span>
<span id="cb15-77"><a href="#cb15-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-78"><a href="#cb15-78" aria-hidden="true" tabindex="-1"></a><span class="fu">### Download and extract AERMOD-related files</span></span>
<span id="cb15-79"><a href="#cb15-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-80"><a href="#cb15-80" aria-hidden="true" tabindex="-1"></a>Use the following code to download the <span class="co">[</span><span class="ot">AERMOD zip file</span><span class="co">](https://github.com/justenvirons/pedagogy/blob/main/GEO346_2023_FallQuarter/Exercise_02/data/aermod.zip)</span> from the GitHub repository into your project directory and extract the file's contents into an "aermod" folder. The contents of this folder include the aermod air dispersion executable file as well as other useful reference information.</span>
<span id="cb15-81"><a href="#cb15-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-84"><a href="#cb15-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-85"><a href="#cb15-85" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb15-86"><a href="#cb15-86" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">"https://github.com/justenvirons/pedagogy/raw/main/GEO346_2023_FallQuarter/Exercise_02/data/aermod.zip"</span>,temp)</span>
<span id="cb15-87"><a href="#cb15-87" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(temp, <span class="at">exdir=</span> <span class="st">"aermod"</span>)</span>
<span id="cb15-88"><a href="#cb15-88" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(temp)</span>
<span id="cb15-89"><a href="#cb15-89" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-90"><a href="#cb15-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-91"><a href="#cb15-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-92"><a href="#cb15-92" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 2. Download and transform emissions and toxicity data</span></span>
<span id="cb15-93"><a href="#cb15-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-94"><a href="#cb15-94" aria-hidden="true" tabindex="-1"></a><span class="fu">### Download NEI data</span></span>
<span id="cb15-95"><a href="#cb15-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-96"><a href="#cb15-96" aria-hidden="true" tabindex="-1"></a>Students will draw from two publicly available datasets for this assignment: NEI and TRI. The <span class="co">[</span><span class="ot">National Emissions Inventory</span><span class="co">](https://www.epa.gov/air-emissions-inventories/national-emissions-inventory-nei)</span> (NEI) is a comprehensive and detailed estimate of air emissions of criteria pollutants, criteria precursors, and hazardous air pollutants from air emissions sources. The NEI is released every three years based primarily upon data provided by State, Local, and Tribal air agencies for sources in their jurisdictions and supplemented by data developed by the US EPA. The NEI is built using the Emissions Inventory System (EIS) first to collect the data from State, Local, and Tribal air agencies and then to blend that data with other data sources. Use the following code to download and subset the latest NEI data to California.</span>
<span id="cb15-97"><a href="#cb15-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-100"><a href="#cb15-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-101"><a href="#cb15-101" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Download, format and save essential datasets</span></span>
<span id="cb15-102"><a href="#cb15-102" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb15-103"><a href="#cb15-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-104"><a href="#cb15-104" aria-hidden="true" tabindex="-1"></a><span class="co"># National Emissions Inventory (zip format)</span></span>
<span id="cb15-105"><a href="#cb15-105" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb15-106"><a href="#cb15-106" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">"https://gaftp.epa.gov/air/nei/2020/data_summaries/Facility%20Level%20by%20Pollutant.zip"</span>,temp)</span>
<span id="cb15-107"><a href="#cb15-107" aria-hidden="true" tabindex="-1"></a>NEI_2020_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">unz</span>(temp, <span class="st">"emis_sum_fac_23959.csv"</span>))</span>
<span id="cb15-108"><a href="#cb15-108" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(temp)</span>
<span id="cb15-109"><a href="#cb15-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-110"><a href="#cb15-110" aria-hidden="true" tabindex="-1"></a><span class="co"># format NEI data</span></span>
<span id="cb15-111"><a href="#cb15-111" aria-hidden="true" tabindex="-1"></a><span class="co"># filter sulfur dioxide releases in California</span></span>
<span id="cb15-112"><a href="#cb15-112" aria-hidden="true" tabindex="-1"></a>NEI_2020_form <span class="ot">&lt;-</span> NEI_2020_raw <span class="sc">%&gt;%</span></span>
<span id="cb15-113"><a href="#cb15-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb15-114"><a href="#cb15-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_name =</span> <span class="st">`</span><span class="at">company name</span><span class="st">`</span>,</span>
<span id="cb15-115"><a href="#cb15-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">site_name =</span> <span class="st">`</span><span class="at">site name</span><span class="st">`</span>,</span>
<span id="cb15-116"><a href="#cb15-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_street =</span> address,</span>
<span id="cb15-117"><a href="#cb15-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_city =</span> city,</span>
<span id="cb15-118"><a href="#cb15-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_state =</span> <span class="st">`</span><span class="at">postal abbreviation</span><span class="st">`</span>,</span>
<span id="cb15-119"><a href="#cb15-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_zip =</span> <span class="st">`</span><span class="at">zip code</span><span class="st">`</span>,</span>
<span id="cb15-120"><a href="#cb15-120" aria-hidden="true" tabindex="-1"></a>    <span class="at">naics_code =</span> <span class="st">`</span><span class="at">primary naics code</span><span class="st">`</span>,</span>
<span id="cb15-121"><a href="#cb15-121" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="st">`</span><span class="at">site latitude</span><span class="st">`</span>,</span>
<span id="cb15-122"><a href="#cb15-122" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="st">`</span><span class="at">site longitude</span><span class="st">`</span>,</span>
<span id="cb15-123"><a href="#cb15-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">pollutant_code =</span> <span class="st">`</span><span class="at">pollutant code</span><span class="st">`</span>,</span>
<span id="cb15-124"><a href="#cb15-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">pollutant_desc =</span> <span class="st">`</span><span class="at">pollutant desc</span><span class="st">`</span>,</span>
<span id="cb15-125"><a href="#cb15-125" aria-hidden="true" tabindex="-1"></a>    <span class="at">pollutant_type =</span> <span class="st">`</span><span class="at">pollutant type(s)</span><span class="st">`</span>,</span>
<span id="cb15-126"><a href="#cb15-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">emissions_uom =</span> <span class="st">`</span><span class="at">emissions uom</span><span class="st">`</span>,</span>
<span id="cb15-127"><a href="#cb15-127" aria-hidden="true" tabindex="-1"></a>    <span class="at">emissions =</span> <span class="st">`</span><span class="at">total emissions</span><span class="st">`</span></span>
<span id="cb15-128"><a href="#cb15-128" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb15-129"><a href="#cb15-129" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb15-130"><a href="#cb15-130" aria-hidden="true" tabindex="-1"></a>    fac_name,</span>
<span id="cb15-131"><a href="#cb15-131" aria-hidden="true" tabindex="-1"></a>    site_name,</span>
<span id="cb15-132"><a href="#cb15-132" aria-hidden="true" tabindex="-1"></a>    fac_street,</span>
<span id="cb15-133"><a href="#cb15-133" aria-hidden="true" tabindex="-1"></a>    fac_city,</span>
<span id="cb15-134"><a href="#cb15-134" aria-hidden="true" tabindex="-1"></a>    fac_state,</span>
<span id="cb15-135"><a href="#cb15-135" aria-hidden="true" tabindex="-1"></a>    fac_zip,</span>
<span id="cb15-136"><a href="#cb15-136" aria-hidden="true" tabindex="-1"></a>    naics_code,</span>
<span id="cb15-137"><a href="#cb15-137" aria-hidden="true" tabindex="-1"></a>    latitude,</span>
<span id="cb15-138"><a href="#cb15-138" aria-hidden="true" tabindex="-1"></a>    longitude,</span>
<span id="cb15-139"><a href="#cb15-139" aria-hidden="true" tabindex="-1"></a>    pollutant_code,</span>
<span id="cb15-140"><a href="#cb15-140" aria-hidden="true" tabindex="-1"></a>    pollutant_desc,</span>
<span id="cb15-141"><a href="#cb15-141" aria-hidden="true" tabindex="-1"></a>    pollutant_type,</span>
<span id="cb15-142"><a href="#cb15-142" aria-hidden="true" tabindex="-1"></a>    emissions_uom,</span>
<span id="cb15-143"><a href="#cb15-143" aria-hidden="true" tabindex="-1"></a>    emissions</span>
<span id="cb15-144"><a href="#cb15-144" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb15-145"><a href="#cb15-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fac_state <span class="sc">==</span> <span class="st">"CA"</span>,</span>
<span id="cb15-146"><a href="#cb15-146" aria-hidden="true" tabindex="-1"></a>         pollutant_code <span class="sc">==</span> <span class="st">"SO2"</span>)</span>
<span id="cb15-147"><a href="#cb15-147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-148"><a href="#cb15-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-149"><a href="#cb15-149" aria-hidden="true" tabindex="-1"></a><span class="fu">### Download TRI data</span></span>
<span id="cb15-150"><a href="#cb15-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-151"><a href="#cb15-151" aria-hidden="true" tabindex="-1"></a>The US EPA's <span class="co">[</span><span class="ot">Toxics Release Inventory</span><span class="co">](https://www.epa.gov/toxics-release-inventory-tri-program/what-toxics-release-inventory)</span> (TRI) program tracks the management of certain toxic chemicals that pose a threat to human health and the environment. Large US facilities (i.e., those emitting 10 tons or more per year) in different industry sectors must report annually how much of each chemical is released to the environment and/or managed through recycling, energy recovery and treatment. Data containing the 100 most-used data fields from the TRI Reporting Form R and Form A Certification Statement are made available in various formats on the <span class="co">[</span><span class="ot">TRI Basic Data web page</span><span class="co">](https://www.epa.gov/toxics-release-inventory-tri-program/tri-basic-data-files-calendar-years-1987-present)</span> for the 2021 reporting year. The data can be downloaded for the entire US or by state. <span class="co">[</span><span class="ot">Reference information for this file in PDF format</span><span class="co">](https://www.epa.gov/system/files/documents/2022-10/TRI_Basic_Data_File_Documentation_RY2021_102522.pdf)</span> is available on the TRI website. Use the following code to download and subset the latest TRI data to California.</span>
<span id="cb15-152"><a href="#cb15-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-155"><a href="#cb15-155" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-156"><a href="#cb15-156" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Toxics Release Inventory (csv format)</span></span>
<span id="cb15-157"><a href="#cb15-157" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb15-158"><a href="#cb15-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-159"><a href="#cb15-159" aria-hidden="true" tabindex="-1"></a>TRI_2021_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://data.epa.gov/efservice/downloads/tri/mv_tri_basic_download/2021_US/csv"</span>)</span>
<span id="cb15-160"><a href="#cb15-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-161"><a href="#cb15-161" aria-hidden="true" tabindex="-1"></a><span class="co"># format TRI data</span></span>
<span id="cb15-162"><a href="#cb15-162" aria-hidden="true" tabindex="-1"></a><span class="co"># filter data stack air releases in California</span></span>
<span id="cb15-163"><a href="#cb15-163" aria-hidden="true" tabindex="-1"></a>TRI_2021_form <span class="ot">&lt;-</span> TRI_2021_raw <span class="sc">%&gt;%</span></span>
<span id="cb15-164"><a href="#cb15-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb15-165"><a href="#cb15-165" aria-hidden="true" tabindex="-1"></a>    <span class="at">year =</span> <span class="dv">1</span>,</span>
<span id="cb15-166"><a href="#cb15-166" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_name =</span> <span class="dv">4</span>,</span>
<span id="cb15-167"><a href="#cb15-167" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_street =</span> <span class="dv">5</span>,</span>
<span id="cb15-168"><a href="#cb15-168" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_city =</span> <span class="dv">6</span>,</span>
<span id="cb15-169"><a href="#cb15-169" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_county =</span> <span class="dv">7</span>,</span>
<span id="cb15-170"><a href="#cb15-170" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_state =</span> <span class="dv">8</span>,</span>
<span id="cb15-171"><a href="#cb15-171" aria-hidden="true" tabindex="-1"></a>    <span class="at">fac_zip =</span> <span class="dv">9</span>,</span>
<span id="cb15-172"><a href="#cb15-172" aria-hidden="true" tabindex="-1"></a>    <span class="at">latitude =</span> <span class="dv">12</span>,</span>
<span id="cb15-173"><a href="#cb15-173" aria-hidden="true" tabindex="-1"></a>    <span class="at">longitude =</span> <span class="dv">13</span>,</span>
<span id="cb15-174"><a href="#cb15-174" aria-hidden="true" tabindex="-1"></a>    <span class="at">parent_co =</span> <span class="dv">15</span>,</span>
<span id="cb15-175"><a href="#cb15-175" aria-hidden="true" tabindex="-1"></a>    <span class="at">sector_code =</span> <span class="dv">19</span>,</span>
<span id="cb15-176"><a href="#cb15-176" aria-hidden="true" tabindex="-1"></a>    <span class="at">sector_name =</span> <span class="dv">20</span>,</span>
<span id="cb15-177"><a href="#cb15-177" aria-hidden="true" tabindex="-1"></a>    <span class="at">chemical =</span> <span class="dv">34</span>,</span>
<span id="cb15-178"><a href="#cb15-178" aria-hidden="true" tabindex="-1"></a>    <span class="at">casno =</span> <span class="dv">37</span>,</span>
<span id="cb15-179"><a href="#cb15-179" aria-hidden="true" tabindex="-1"></a>    <span class="at">srsid =</span> <span class="dv">38</span>,</span>
<span id="cb15-180"><a href="#cb15-180" aria-hidden="true" tabindex="-1"></a>    <span class="at">caa_chemical =</span> <span class="dv">39</span>,</span>
<span id="cb15-181"><a href="#cb15-181" aria-hidden="true" tabindex="-1"></a>    <span class="at">carcinogen =</span> <span class="dv">43</span>,</span>
<span id="cb15-182"><a href="#cb15-182" aria-hidden="true" tabindex="-1"></a>    <span class="at">pfas =</span> <span class="dv">45</span>,</span>
<span id="cb15-183"><a href="#cb15-183" aria-hidden="true" tabindex="-1"></a>    <span class="at">emissions_uom =</span> <span class="dv">47</span>,</span>
<span id="cb15-184"><a href="#cb15-184" aria-hidden="true" tabindex="-1"></a>    <span class="at">fugitive_air =</span> <span class="dv">48</span>,</span>
<span id="cb15-185"><a href="#cb15-185" aria-hidden="true" tabindex="-1"></a>    <span class="at">stack_air =</span> <span class="dv">49</span>,</span>
<span id="cb15-186"><a href="#cb15-186" aria-hidden="true" tabindex="-1"></a>    <span class="at">water =</span> <span class="dv">50</span>,</span>
<span id="cb15-187"><a href="#cb15-187" aria-hidden="true" tabindex="-1"></a>    <span class="at">underground =</span> <span class="dv">51</span></span>
<span id="cb15-188"><a href="#cb15-188" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb15-189"><a href="#cb15-189" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb15-190"><a href="#cb15-190" aria-hidden="true" tabindex="-1"></a>    year,</span>
<span id="cb15-191"><a href="#cb15-191" aria-hidden="true" tabindex="-1"></a>    fac_name,</span>
<span id="cb15-192"><a href="#cb15-192" aria-hidden="true" tabindex="-1"></a>    fac_street,</span>
<span id="cb15-193"><a href="#cb15-193" aria-hidden="true" tabindex="-1"></a>    fac_city,</span>
<span id="cb15-194"><a href="#cb15-194" aria-hidden="true" tabindex="-1"></a>    fac_county,</span>
<span id="cb15-195"><a href="#cb15-195" aria-hidden="true" tabindex="-1"></a>    fac_state,</span>
<span id="cb15-196"><a href="#cb15-196" aria-hidden="true" tabindex="-1"></a>    fac_zip,</span>
<span id="cb15-197"><a href="#cb15-197" aria-hidden="true" tabindex="-1"></a>    latitude,</span>
<span id="cb15-198"><a href="#cb15-198" aria-hidden="true" tabindex="-1"></a>    longitude,</span>
<span id="cb15-199"><a href="#cb15-199" aria-hidden="true" tabindex="-1"></a>    parent_co,</span>
<span id="cb15-200"><a href="#cb15-200" aria-hidden="true" tabindex="-1"></a>    sector_code,</span>
<span id="cb15-201"><a href="#cb15-201" aria-hidden="true" tabindex="-1"></a>    sector_name,</span>
<span id="cb15-202"><a href="#cb15-202" aria-hidden="true" tabindex="-1"></a>    chemical,</span>
<span id="cb15-203"><a href="#cb15-203" aria-hidden="true" tabindex="-1"></a>    casno,</span>
<span id="cb15-204"><a href="#cb15-204" aria-hidden="true" tabindex="-1"></a>    srsid,</span>
<span id="cb15-205"><a href="#cb15-205" aria-hidden="true" tabindex="-1"></a>    caa_chemical,</span>
<span id="cb15-206"><a href="#cb15-206" aria-hidden="true" tabindex="-1"></a>    carcinogen,</span>
<span id="cb15-207"><a href="#cb15-207" aria-hidden="true" tabindex="-1"></a>    pfas,</span>
<span id="cb15-208"><a href="#cb15-208" aria-hidden="true" tabindex="-1"></a>    emissions_uom,</span>
<span id="cb15-209"><a href="#cb15-209" aria-hidden="true" tabindex="-1"></a>    fugitive_air,</span>
<span id="cb15-210"><a href="#cb15-210" aria-hidden="true" tabindex="-1"></a>    stack_air,</span>
<span id="cb15-211"><a href="#cb15-211" aria-hidden="true" tabindex="-1"></a>    water,</span>
<span id="cb15-212"><a href="#cb15-212" aria-hidden="true" tabindex="-1"></a>    underground</span>
<span id="cb15-213"><a href="#cb15-213" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb15-214"><a href="#cb15-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fac_state <span class="sc">==</span> <span class="st">"CA"</span>,</span>
<span id="cb15-215"><a href="#cb15-215" aria-hidden="true" tabindex="-1"></a>         stack_air <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb15-216"><a href="#cb15-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-217"><a href="#cb15-217" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-218"><a href="#cb15-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-219"><a href="#cb15-219" aria-hidden="true" tabindex="-1"></a><span class="fu">### Download RSEI data</span></span>
<span id="cb15-220"><a href="#cb15-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-221"><a href="#cb15-221" aria-hidden="true" tabindex="-1"></a>EPA's Risk-Screening Environmental Indicators (RSEI) model helps policy makers, researchers, and communities explore data on releases of toxic substances from industrial and federal facilities. The model considers the fate and transport of chemicals through the environment, each chemical's relative toxicity, and potential human exposure. When combined with the total releases of chemicals by location, RSEI model results can be used to help identify locations of toxic hot spots, monitor potential human health impacts over time, prioritize investigative work and prioritize the allocation of agency resources, more generally. Use the following code to import the latest RSEI toxicity weights from the course GitHub, then join RSEI toxicity weights to the TRI data. *Note that the toxicity weights are reduced by a factor of 10\^5 so that dispersion values can be more easily computed using AERMOD.*</span>
<span id="cb15-222"><a href="#cb15-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-225"><a href="#cb15-225" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-226"><a href="#cb15-226" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Import RSEI data from GitHub</span></span>
<span id="cb15-227"><a href="#cb15-227" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb15-228"><a href="#cb15-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-229"><a href="#cb15-229" aria-hidden="true" tabindex="-1"></a><span class="co"># RSEI data (Excel format)</span></span>
<span id="cb15-230"><a href="#cb15-230" aria-hidden="true" tabindex="-1"></a><span class="co"># This reference dataset is reguarly updated at https://www.epa.gov/rsei/rsei-toxicity-data-and-calculations</span></span>
<span id="cb15-231"><a href="#cb15-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-232"><a href="#cb15-232" aria-hidden="true" tabindex="-1"></a>RSEI_v2311_raw <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="st">"https://github.com/justenvirons/pedagogy/raw/main/GEO346_2023_FallQuarter/Exercise_02/data/toxicity_data_rsei_v2311.xlsx"</span>, <span class="at">sheet=</span><span class="dv">2</span>)</span>
<span id="cb15-233"><a href="#cb15-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-234"><a href="#cb15-234" aria-hidden="true" tabindex="-1"></a>RSEI_v2311_form <span class="ot">&lt;-</span> RSEI_v2311_raw <span class="sc">%&gt;%</span></span>
<span id="cb15-235"><a href="#cb15-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">casno =</span> CASStandard) <span class="sc">%&gt;%</span></span>
<span id="cb15-236"><a href="#cb15-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">itw =</span> <span class="fu">as.numeric</span>(ITW)) <span class="sc">%&gt;%</span></span>
<span id="cb15-237"><a href="#cb15-237" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(casno, </span>
<span id="cb15-238"><a href="#cb15-238" aria-hidden="true" tabindex="-1"></a>         itw)</span>
<span id="cb15-239"><a href="#cb15-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-240"><a href="#cb15-240" aria-hidden="true" tabindex="-1"></a><span class="co"># Join TRI with RSEI inhalation toxicity weights (ITW)</span></span>
<span id="cb15-241"><a href="#cb15-241" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop coordinates with NA values</span></span>
<span id="cb15-242"><a href="#cb15-242" aria-hidden="true" tabindex="-1"></a>TRI_2021_form_wtd <span class="ot">&lt;-</span> TRI_2021_form <span class="sc">%&gt;%</span> </span>
<span id="cb15-243"><a href="#cb15-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(RSEI_v2311_form, <span class="at">by =</span> <span class="st">"casno"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-244"><a href="#cb15-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stack_air_itw =</span> stack_air <span class="sc">*</span> itw<span class="sc">/</span><span class="dv">1000000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-245"><a href="#cb15-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(stack_air_itw) <span class="sc">%&gt;%</span></span>
<span id="cb15-246"><a href="#cb15-246" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>itw) <span class="sc">%&gt;%</span></span>
<span id="cb15-247"><a href="#cb15-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(<span class="fu">c</span>(latitude,longitude))</span>
<span id="cb15-248"><a href="#cb15-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-249"><a href="#cb15-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-250"><a href="#cb15-250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-251"><a href="#cb15-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-252"><a href="#cb15-252" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="true"}</span>
<span id="cb15-253"><a href="#cb15-253" aria-hidden="true" tabindex="-1"></a><span class="fu">### Learn more about RSEI results</span></span>
<span id="cb15-254"><a href="#cb15-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-255"><a href="#cb15-255" aria-hidden="true" tabindex="-1"></a>Watch the below video to learn more about the results produced by EPA's Risk-Screening Environmental Indicators (RSEI) model.</span>
<span id="cb15-256"><a href="#cb15-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-257"><a href="#cb15-257" aria-hidden="true" tabindex="-1"></a>{{&lt; video https://www.youtube.com/watch?v=U08DBEIf7x4 &gt;}}</span>
<span id="cb15-258"><a href="#cb15-258" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb15-259"><a href="#cb15-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-260"><a href="#cb15-260" aria-hidden="true" tabindex="-1"></a><span class="fu">### Create and write shapefiles</span></span>
<span id="cb15-261"><a href="#cb15-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-262"><a href="#cb15-262" aria-hidden="true" tabindex="-1"></a>Modify the below code to save the NEI and TRI air pollution tables as shapefiles into your working directory, perhaps in the "data" folder (e.g., "data/TRI_2021.shp" and "data/NEI_2020.shp"). If you are choosing to examine an area located within northern California, use UTM 10N (EPSG: 26910) or UTM 11N (EPSG: 26911) if your study area is in southern California. See a general map of the UTM zones for the contiguous United States below.</span>
<span id="cb15-263"><a href="#cb15-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-264"><a href="#cb15-264" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/fig44.gif)</span></span>
<span id="cb15-265"><a href="#cb15-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-268"><a href="#cb15-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-269"><a href="#cb15-269" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Create and write shapefiles for importing into ArcGIS Pro</span></span>
<span id="cb15-270"><a href="#cb15-270" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb15-271"><a href="#cb15-271" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(TRI_2021_form_wtd_geom)</span>
<span id="cb15-272"><a href="#cb15-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-273"><a href="#cb15-273" aria-hidden="true" tabindex="-1"></a>TRI_2021_form_wtd_geom <span class="ot">&lt;-</span></span>
<span id="cb15-274"><a href="#cb15-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(TRI_2021_form_wtd,</span>
<span id="cb15-275"><a href="#cb15-275" aria-hidden="true" tabindex="-1"></a>           <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb15-276"><a href="#cb15-276" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs =</span> <span class="dv">4269</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">26911</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-277"><a href="#cb15-277" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-278"><a href="#cb15-278" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">st_coordinates</span>(.))</span>
<span id="cb15-279"><a href="#cb15-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-280"><a href="#cb15-280" aria-hidden="true" tabindex="-1"></a><span class="co"># create basic plot of TRI facilities</span></span>
<span id="cb15-281"><a href="#cb15-281" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(TRI_2021_form_wtd_geom[<span class="st">'srsid'</span>])</span>
<span id="cb15-282"><a href="#cb15-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-283"><a href="#cb15-283" aria-hidden="true" tabindex="-1"></a><span class="co"># write TRI data to shapefile</span></span>
<span id="cb15-284"><a href="#cb15-284" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(TRI_2021_form_wtd_geom,</span>
<span id="cb15-285"><a href="#cb15-285" aria-hidden="true" tabindex="-1"></a>         <span class="st">"enter working directory and desired file name"</span>,</span>
<span id="cb15-286"><a href="#cb15-286" aria-hidden="true" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-287"><a href="#cb15-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-288"><a href="#cb15-288" aria-hidden="true" tabindex="-1"></a>NEI_2020_form_geom <span class="ot">&lt;-</span></span>
<span id="cb15-289"><a href="#cb15-289" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(NEI_2020_form,</span>
<span id="cb15-290"><a href="#cb15-290" aria-hidden="true" tabindex="-1"></a>           <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"longitude"</span>, <span class="st">"latitude"</span>),</span>
<span id="cb15-291"><a href="#cb15-291" aria-hidden="true" tabindex="-1"></a>           <span class="at">crs =</span> <span class="dv">4269</span>) <span class="sc">%&gt;%</span> <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">26911</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-292"><a href="#cb15-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-293"><a href="#cb15-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">st_coordinates</span>(.)) <span class="co"># or crs = 26910 if in northern California</span></span>
<span id="cb15-294"><a href="#cb15-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-295"><a href="#cb15-295" aria-hidden="true" tabindex="-1"></a><span class="co"># create basic plot of NEI facilities</span></span>
<span id="cb15-296"><a href="#cb15-296" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(NEI_2020_form_wtd_geom[<span class="st">'srsid'</span>])</span>
<span id="cb15-297"><a href="#cb15-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-298"><a href="#cb15-298" aria-hidden="true" tabindex="-1"></a><span class="co"># write NEI data to shapefile</span></span>
<span id="cb15-299"><a href="#cb15-299" aria-hidden="true" tabindex="-1"></a><span class="fu">st_write</span>(NEI_2020_form_geom,</span>
<span id="cb15-300"><a href="#cb15-300" aria-hidden="true" tabindex="-1"></a>         <span class="st">"enter working directory and desired file name"</span>,</span>
<span id="cb15-301"><a href="#cb15-301" aria-hidden="true" tabindex="-1"></a>         <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-302"><a href="#cb15-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-303"><a href="#cb15-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-304"><a href="#cb15-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-305"><a href="#cb15-305" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 3. Create and add data to ArcGIS Pro project</span></span>
<span id="cb15-306"><a href="#cb15-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-307"><a href="#cb15-307" aria-hidden="true" tabindex="-1"></a><span class="fu">### Add NEI and TRI to ArcGIS Pro</span></span>
<span id="cb15-308"><a href="#cb15-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-309"><a href="#cb15-309" aria-hidden="true" tabindex="-1"></a>Create a new ArcGIS Pro project on your computer under the maps directory in your R project folder. In your ArcGIS Pro map project, under the "Map" menu, click the "Add Data" option on the toolbar and navigate to the directory where you exported the NEI and TRI datasets. You may need to click the "Connect to Folder" and navigate to your project directory. Select all three of the files and add to the map frame. They should draw automatically and appear in the table of contents.</span>
<span id="cb15-310"><a href="#cb15-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-311"><a href="#cb15-311" aria-hidden="true" tabindex="-1"></a><span class="fu">### Download and add air basin boundaries to ArcGIS Pro</span></span>
<span id="cb15-312"><a href="#cb15-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-313"><a href="#cb15-313" aria-hidden="true" tabindex="-1"></a>Use the following code to download the <span class="co">[</span><span class="ot">California county, air basin and air district boundary file</span><span class="co">](https://ww3.arb.ca.gov/ei/gislib/boundaries/ca_co_ab_dis.zip)</span> from the <span class="co">[</span><span class="ot">California Air Resources Board (CARB) GIS Library web page</span><span class="co">](https://ww2.arb.ca.gov/geographical-information-system-gis-library)</span> and extract files to your "data" directory. The air basin boundaries will be helpful to identify the entity that provides AERMOD-ready meteorological data near your facility given that AERMOD requires such data to estimate the geographic distribution of releases over time.</span>
<span id="cb15-314"><a href="#cb15-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-317"><a href="#cb15-317" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-318"><a href="#cb15-318" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: Air basin shapefile from California ARB webpage</span></span>
<span id="cb15-319"><a href="#cb15-319" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb15-320"><a href="#cb15-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-321"><a href="#cb15-321" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb15-322"><a href="#cb15-322" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">"https://ww3.arb.ca.gov/ei/gislib/boundaries/ca_co_ab_dis.zip"</span>,</span>
<span id="cb15-323"><a href="#cb15-323" aria-hidden="true" tabindex="-1"></a>              temp)</span>
<span id="cb15-324"><a href="#cb15-324" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(<span class="at">zipfile =</span> temp,</span>
<span id="cb15-325"><a href="#cb15-325" aria-hidden="true" tabindex="-1"></a>      <span class="at">exdir =</span> <span class="st">"data"</span>,</span>
<span id="cb15-326"><a href="#cb15-326" aria-hidden="true" tabindex="-1"></a>      <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-327"><a href="#cb15-327" aria-hidden="true" tabindex="-1"></a><span class="fu">unlink</span>(temp)</span>
<span id="cb15-328"><a href="#cb15-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-329"><a href="#cb15-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-330"><a href="#cb15-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-331"><a href="#cb15-331" aria-hidden="true" tabindex="-1"></a><span class="fu">### Download meteorological data</span></span>
<span id="cb15-332"><a href="#cb15-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-333"><a href="#cb15-333" aria-hidden="true" tabindex="-1"></a>The California Air Resources Board (CARB) makes available <span class="co">[</span><span class="ot">AERMOD-ready meteorological data for 28 select weather stations throughout the state</span><span class="co">](https://ww2.arb.ca.gov/resources/documents/harp-aermod-meteorological-files)</span> while the various air quality districts make available similarly formatted data for weather stations within their respective jurisdictions. Links to the district-specific weather station and data are also available via district links on the <span class="co">[</span><span class="ot">ARB meteorological data webpage</span><span class="co">](https://ww2.arb.ca.gov/resources/documents/harp-aermod-meteorological-files)</span>. Save the appropriate meteorological data in your "aermod" folder.</span>
<span id="cb15-334"><a href="#cb15-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-335"><a href="#cb15-335" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 4. Create and center study area</span></span>
<span id="cb15-336"><a href="#cb15-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-337"><a href="#cb15-337" aria-hidden="true" tabindex="-1"></a>You are tasked with estimating emissions from an existing facility. You will need to create a custom and spatially explicit study area centered on your facility of interest in order to run the needed calculations. Create your custom study area by doing the following:</span>
<span id="cb15-338"><a href="#cb15-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-339"><a href="#cb15-339" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>First, identify a single facility in the NEI facilities shapefile that emits considerable amounts of sulfur dioxide (SO2), perhaps over 100 tons per year. Zoom to the facility in ArcGIS Pro.</span>
<span id="cb15-340"><a href="#cb15-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-341"><a href="#cb15-341" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Under the "View" menu, click the "Catalog Pane" option to view project contents. Navigate to your project folder and right-click on the "data" directory to create a new shapefile. With your project directory selected, open the File menu and select the "New/Shapefile" option. In the "Create Feature Class" dialog box, give your polygonal shapefile an appropriate name (e.g., studyarea). Be sure the output coordinate system corresponds with the other shapefiles in your map frame (i.e., UTM Zone 10N, NAD 1983). When finished, add the new shapefile to the map.</span>
<span id="cb15-342"><a href="#cb15-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-343"><a href="#cb15-343" aria-hidden="true" tabindex="-1"></a>    <span class="al">![](images/paste-D249D986.png)</span>{width="3in"}</span>
<span id="cb15-344"><a href="#cb15-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-345"><a href="#cb15-345" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In the "Edit" menu, click "Create" to begin delineating the study area polygon. In the "Create Features" dialog, use the square template to construct the polygon. With the pencil tool activated, create a 10km by 10km square by clicking the map to create the initial vertex. Don't be concerned about the specific location of the initial vertex (and study area) at this time. While still editing, right-click inside the map frame and select the "Direction/Size" option to make visible the associated dialog box. Enter "0" for direction and 10km for both length and width. When finished entering the dimensions click the Enter key on your keyboard to create the new feature.</span>
<span id="cb15-346"><a href="#cb15-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-347"><a href="#cb15-347" aria-hidden="true" tabindex="-1"></a>    <span class="al">![](images/paste-F8F29155.png)</span>{width="1.5in"}</span>
<span id="cb15-348"><a href="#cb15-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-349"><a href="#cb15-349" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Lastly, center your study area so that the facility you identified is located in the (approximate) center. Do this by clicking on the "Edit" menu and selecting the study area polygon. Use the "Move" tool to position the polygon in the desired location. Save your edits. Under the "Share" menu, click "Capture to Clipboard" and paste the NEI facilities map into the appropriate PowerPoint slide.</span>
<span id="cb15-350"><a href="#cb15-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-351"><a href="#cb15-351" aria-hidden="true" tabindex="-1"></a>    <span class="al">![](images/paste-8B95D98A.png)</span>{width="2in"}</span>
<span id="cb15-352"><a href="#cb15-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-353"><a href="#cb15-353" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 5. Model single facility pollutant (SO2) concentrations using AERMOD</span></span>
<span id="cb15-354"><a href="#cb15-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-355"><a href="#cb15-355" aria-hidden="true" tabindex="-1"></a>In this part of the exercise you will analyze the concentrations of sulfur dioxide emitted from the facility you selected within your study area. *Note that you may need to run the AERMOD executable locally on your computer if Virtual Lab returns an error.*</span>
<span id="cb15-356"><a href="#cb15-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-357"><a href="#cb15-357" aria-hidden="true" tabindex="-1"></a><span class="fu">### Customize parameters in the AERMOD input file (AERMOD.INP)</span></span>
<span id="cb15-358"><a href="#cb15-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-359"><a href="#cb15-359" aria-hidden="true" tabindex="-1"></a>Now you will use AERMOD to model emissions from the facility you selected.</span>
<span id="cb15-360"><a href="#cb15-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-361"><a href="#cb15-361" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Using a text editor (such as notepad), open the AERMOD.INP (i.e., runstream) file located in the aermod folder. You will need to modify parameters in this file to estimate geographic distributions of pollutant concentrations from your selected facility. The runstream file is divided into five functional "pathways." These pathways are identified by a two-character pathway ID placed at the beginning of each runstream image. The start and end of each pathway in the code are bookmarked with "STARTING" and "ENDING" statements. The pathways and the order in which they are specified in the runstream are as follows:</span>
<span id="cb15-362"><a href="#cb15-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-363"><a href="#cb15-363" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>CO - for specifying overall job COntrol options;</span>
<span id="cb15-364"><a href="#cb15-364" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>SO - for specifying pollution SOurce information;</span>
<span id="cb15-365"><a href="#cb15-365" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>RE - for specifying REceptor information;</span>
<span id="cb15-366"><a href="#cb15-366" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>ME - for specifying MEteorology information;</span>
<span id="cb15-367"><a href="#cb15-367" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>EV - for specifiying EVent processing;</span>
<span id="cb15-368"><a href="#cb15-368" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>OU - for specifying OUtput options.</span>
<span id="cb15-369"><a href="#cb15-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-370"><a href="#cb15-370" aria-hidden="true" tabindex="-1"></a>For this exercise, you will be using all but the event (EV) pathway. The default contents and parameters of the AERMOD runstream file you extracted to your aermod directory are shown below.</span>
<span id="cb15-371"><a href="#cb15-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-374"><a href="#cb15-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{verbatim}</span></span>
<span id="cb15-375"><a href="#cb15-375" aria-hidden="true" tabindex="-1"></a><span class="in">CO STARTING</span></span>
<span id="cb15-376"><a href="#cb15-376" aria-hidden="true" tabindex="-1"></a><span class="in">CO TITLEONE SINGLEFAC</span></span>
<span id="cb15-377"><a href="#cb15-377" aria-hidden="true" tabindex="-1"></a><span class="in">CO MODELOPT CONC FLAT</span></span>
<span id="cb15-378"><a href="#cb15-378" aria-hidden="true" tabindex="-1"></a><span class="in">CO AVERTIME 1 3</span></span>
<span id="cb15-379"><a href="#cb15-379" aria-hidden="true" tabindex="-1"></a><span class="in">CO POLLUTID SO2</span></span>
<span id="cb15-380"><a href="#cb15-380" aria-hidden="true" tabindex="-1"></a><span class="in">CO RUNORNOT RUN</span></span>
<span id="cb15-381"><a href="#cb15-381" aria-hidden="true" tabindex="-1"></a><span class="in">CO ERRORFIL ERRORS.OUT</span></span>
<span id="cb15-382"><a href="#cb15-382" aria-hidden="true" tabindex="-1"></a><span class="in">CO FINISHED</span></span>
<span id="cb15-383"><a href="#cb15-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-384"><a href="#cb15-384" aria-hidden="true" tabindex="-1"></a><span class="in">SO STARTING</span></span>
<span id="cb15-385"><a href="#cb15-385" aria-hidden="true" tabindex="-1"></a><span class="in">SO LOCATION FAC1 POINT 385362 3741767 0.0</span></span>
<span id="cb15-386"><a href="#cb15-386" aria-hidden="true" tabindex="-1"></a><span class="in">SO SRCPARAM FAC1 9.13 76. 353. 5. 3.0</span></span>
<span id="cb15-387"><a href="#cb15-387" aria-hidden="true" tabindex="-1"></a><span class="in">SO SRCGROUP ALL</span></span>
<span id="cb15-388"><a href="#cb15-388" aria-hidden="true" tabindex="-1"></a><span class="in">SO FINISHED</span></span>
<span id="cb15-389"><a href="#cb15-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-390"><a href="#cb15-390" aria-hidden="true" tabindex="-1"></a><span class="in">RE STARTING</span></span>
<span id="cb15-391"><a href="#cb15-391" aria-hidden="true" tabindex="-1"></a><span class="in">   GRIDCART NET1 STA</span></span>
<span id="cb15-392"><a href="#cb15-392" aria-hidden="true" tabindex="-1"></a><span class="in">                XYINC 380239 50 200. 3736617 50 200.</span></span>
<span id="cb15-393"><a href="#cb15-393" aria-hidden="true" tabindex="-1"></a><span class="in">   GRIDCART NET1 END</span></span>
<span id="cb15-394"><a href="#cb15-394" aria-hidden="true" tabindex="-1"></a><span class="in">RE FINISHED</span></span>
<span id="cb15-395"><a href="#cb15-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-396"><a href="#cb15-396" aria-hidden="true" tabindex="-1"></a><span class="in">ME STARTING</span></span>
<span id="cb15-397"><a href="#cb15-397" aria-hidden="true" tabindex="-1"></a><span class="in">ME SURFFILE KLGB_v9.SFC</span></span>
<span id="cb15-398"><a href="#cb15-398" aria-hidden="true" tabindex="-1"></a><span class="in">ME PROFFILE KLGB_v9.PFL</span></span>
<span id="cb15-399"><a href="#cb15-399" aria-hidden="true" tabindex="-1"></a><span class="in">ME PROFBASE 0.0 METERS</span></span>
<span id="cb15-400"><a href="#cb15-400" aria-hidden="true" tabindex="-1"></a><span class="in">ME SURFDATA 23129 2016</span></span>
<span id="cb15-401"><a href="#cb15-401" aria-hidden="true" tabindex="-1"></a><span class="in">ME UAIRDATA 3190 2016</span></span>
<span id="cb15-402"><a href="#cb15-402" aria-hidden="true" tabindex="-1"></a><span class="in">ME FINISHED</span></span>
<span id="cb15-403"><a href="#cb15-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-404"><a href="#cb15-404" aria-hidden="true" tabindex="-1"></a><span class="in">OU STARTING</span></span>
<span id="cb15-405"><a href="#cb15-405" aria-hidden="true" tabindex="-1"></a><span class="in">OU PLOTFILE 1 ALL FIRST 1HRMAX1.PLT</span></span>
<span id="cb15-406"><a href="#cb15-406" aria-hidden="true" tabindex="-1"></a><span class="in">OU PLOTFILE 3 ALL FIRST 3HRMAX1.PLT</span></span>
<span id="cb15-407"><a href="#cb15-407" aria-hidden="true" tabindex="-1"></a><span class="in">OU FINISHED</span></span>
<span id="cb15-408"><a href="#cb15-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-409"><a href="#cb15-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-410"><a href="#cb15-410" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The control pathway (CO) in the runstream code specifies a run entitled SINGLEFAC which calculates average maximum concentrations of a pollutant (here specified as POLLUTID SO2) over 1- and 3-hour periods (AVERTIME 1 3). Concentrations will be calculated in micrograms per cubic meter (µg/m\^3) based on an assumed flat terrain (FLAT). Any errors will be saved into an error file named ERRORS.OUT. *The default parameters can be used in the control pathway.*</span>
<span id="cb15-411"><a href="#cb15-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-412"><a href="#cb15-412" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb15-413"><a href="#cb15-413" aria-hidden="true" tabindex="-1"></a><span class="in">CO STARTING</span></span>
<span id="cb15-414"><a href="#cb15-414" aria-hidden="true" tabindex="-1"></a><span class="in">CO TITLEONE SINGLEFAC</span></span>
<span id="cb15-415"><a href="#cb15-415" aria-hidden="true" tabindex="-1"></a><span class="in">CO MODELOPT CONC FLAT</span></span>
<span id="cb15-416"><a href="#cb15-416" aria-hidden="true" tabindex="-1"></a><span class="in">CO AVERTIME 1 3</span></span>
<span id="cb15-417"><a href="#cb15-417" aria-hidden="true" tabindex="-1"></a><span class="in">CO POLLUTID SO2</span></span>
<span id="cb15-418"><a href="#cb15-418" aria-hidden="true" tabindex="-1"></a><span class="in">CO RUNORNOT RUN</span></span>
<span id="cb15-419"><a href="#cb15-419" aria-hidden="true" tabindex="-1"></a><span class="in">CO ERRORFIL ERRORS.OUT</span></span>
<span id="cb15-420"><a href="#cb15-420" aria-hidden="true" tabindex="-1"></a><span class="in">CO FINISHED</span></span>
<span id="cb15-421"><a href="#cb15-421" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-422"><a href="#cb15-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-423"><a href="#cb15-423" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The source pathway (SO) code establishes sources of pollution. For this exercise, you will specify a single point source of pollution; your selected facility from the National Emissions Inventory dataset. In the example code, the location (SO LOCATION) coordinates (X and Y) reflect those for a facility in Long Beach, California and the source parameters (SO SRCPARAM) specify the rate of SO2 emissions from the selected facility in the proper units (grams per second), assuming a steady state of releases from the facility over a one-year period. *Change these parameters to reflect those of the facility you selected.* The <span class="co">[</span><span class="ot">AERMOD_Formatting.xlsx</span><span class="co">](https://github.com/justenvirons/pedagogy/raw/main/GEO346_2022_FallQuarter/Exercise_02/aermod/AERMODFormatting.xls)</span> spreadsheet extracted to your aermod folder provides tools to help with formatting the SO LOCATION AND SO SRCPARAM parameters including converting tons per year to grams per second (g/s) using the following formula:</span>
<span id="cb15-424"><a href="#cb15-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-425"><a href="#cb15-425" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb15-426"><a href="#cb15-426" aria-hidden="true" tabindex="-1"></a>g/s = (tons/year<span class="sc">\*</span>2000 pounds/year<span class="sc">\*</span>453.59237 grams/pound)/(365 days/year <span class="sc">\*</span> 24 hrs/day <span class="sc">\*</span> 60 minutes/hour <span class="sc">\*</span> 60 seconds/minute))</span>
<span id="cb15-427"><a href="#cb15-427" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb15-428"><a href="#cb15-428" aria-hidden="true" tabindex="-1"></a>Use the default (i.e., existing) settings for the release height, stack gas exit temperature, stack gas exit velocity, and stack diameter (e.g., 76. 353. 5. 3.0) for the facility if not known.</span>
<span id="cb15-429"><a href="#cb15-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-430"><a href="#cb15-430" aria-hidden="true" tabindex="-1"></a><span class="in">```         </span></span>
<span id="cb15-431"><a href="#cb15-431" aria-hidden="true" tabindex="-1"></a><span class="in">SO STARTING</span></span>
<span id="cb15-432"><a href="#cb15-432" aria-hidden="true" tabindex="-1"></a><span class="in">SO LOCATION FAC1 POINT 385362 3741767 0.0</span></span>
<span id="cb15-433"><a href="#cb15-433" aria-hidden="true" tabindex="-1"></a><span class="in">SO SRCPARAM FAC1 9.13 76. 353. 5. 3.0</span></span>
<span id="cb15-434"><a href="#cb15-434" aria-hidden="true" tabindex="-1"></a><span class="in">SO SRCGROUP ALL</span></span>
<span id="cb15-435"><a href="#cb15-435" aria-hidden="true" tabindex="-1"></a><span class="in">SO FINISHED</span></span>
<span id="cb15-436"><a href="#cb15-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-437"><a href="#cb15-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-438"><a href="#cb15-438" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The receptor (or RE) pathway specifies a Cartesian grid (GRIDCART) with 50 nodes spaced every 200 meters in the x direction and the same in the y direction beginning at the southwest corner of the study area. The example code designates the first coordinate, *380239*, as the location of lower left vertex of the study area in the x direction and the second coordinate, *3736617*, as the location of the lower left vertex of the study area in the y direction in UTM coordinates. The entire grid spans 10 km by 10 km. You can again use the [AERMODFormatting.xlsx](https://github.com/justenvirons/pedagogy/blob/main/GEO346_2023_FallQuarter/Exercise_02/aermod/AERMODFormatting.xls) spreadsheet to format the GRIDCART XYINC parameter in the AERMOD.INP file. *Change the coordinates in the receptor pathway to match those of the southwest corner of your study area.*</span>
<span id="cb15-439"><a href="#cb15-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-440"><a href="#cb15-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-441"><a href="#cb15-441" aria-hidden="true" tabindex="-1"></a><span class="in">RE STARTING</span></span>
<span id="cb15-442"><a href="#cb15-442" aria-hidden="true" tabindex="-1"></a><span class="in">   GRIDCART NET1 STA</span></span>
<span id="cb15-443"><a href="#cb15-443" aria-hidden="true" tabindex="-1"></a><span class="in">                XYINC 380239 50 200. 3736617 50 200.</span></span>
<span id="cb15-444"><a href="#cb15-444" aria-hidden="true" tabindex="-1"></a><span class="in">   GRIDCART NET1 END</span></span>
<span id="cb15-445"><a href="#cb15-445" aria-hidden="true" tabindex="-1"></a><span class="in">RE FINISHED</span></span>
<span id="cb15-446"><a href="#cb15-446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-447"><a href="#cb15-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-448"><a href="#cb15-448" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Edit the meteorological (ME) pathway, so that it references the surface (SURFILE) and upper air (PROFFILE) meteorological files for the meteorological station nearest your study area. The example code references the associated files for the Long Beach Municipal Airport (KLGB_v9.SFC and KLGB_v9.PFL). Also note the codes for the surface (SURFDATA) and upper air (UAIRDATA) meteorological stations used in your data and the year of the data being processed. For example, in the sample AERMOD.INP file, the surface meteorological station code is "23129" and the upper air station code is "3190" and the meteorological data span through 2016. These identification codes can be found in the header of the *.SFC meteorological file. The meteorological pathway also allows users to specify discrete start and end dates. In this example, the STARTEND parameter is set to a single year of meteorological data (1/1/2016 to 12/31/2016). These dates may need to be changed depending on the year of your meteorological data.</span>
<span id="cb15-449"><a href="#cb15-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-450"><a href="#cb15-450" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-451"><a href="#cb15-451" aria-hidden="true" tabindex="-1"></a><span class="in">ME STARTING</span></span>
<span id="cb15-452"><a href="#cb15-452" aria-hidden="true" tabindex="-1"></a><span class="in">ME SURFFILE KLGB_v9.SFC</span></span>
<span id="cb15-453"><a href="#cb15-453" aria-hidden="true" tabindex="-1"></a><span class="in">ME PROFFILE KLGB_v9.PFL</span></span>
<span id="cb15-454"><a href="#cb15-454" aria-hidden="true" tabindex="-1"></a><span class="in">ME PROFBASE 0.0 METERS</span></span>
<span id="cb15-455"><a href="#cb15-455" aria-hidden="true" tabindex="-1"></a><span class="in">ME SURFDATA 23129 2012</span></span>
<span id="cb15-456"><a href="#cb15-456" aria-hidden="true" tabindex="-1"></a><span class="in">ME UAIRDATA 3190 2012</span></span>
<span id="cb15-457"><a href="#cb15-457" aria-hidden="true" tabindex="-1"></a><span class="in">ME STARTEND 2016 01 01 2016 12 31</span></span>
<span id="cb15-458"><a href="#cb15-458" aria-hidden="true" tabindex="-1"></a><span class="in">ME FINISHED</span></span>
<span id="cb15-459"><a href="#cb15-459" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-460"><a href="#cb15-460" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Lastly, set the output (OU) pathway to create four plot files, with each representing key concentrations over given periods of time. The default input file calculates maximum concentrations averaged over one- and three-hour periods. Concentrations will be estimated for each of the 2,500 receptors in your study area. The default file names for the output plot files in the OU parameters are 1HRMAX.PLT (for the one-hour concentrations) and 3HRMAX.PLT (for the three-hour concentrations).</span>
<span id="cb15-461"><a href="#cb15-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-462"><a href="#cb15-462" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-463"><a href="#cb15-463" aria-hidden="true" tabindex="-1"></a><span class="in">OU STARTING</span></span>
<span id="cb15-464"><a href="#cb15-464" aria-hidden="true" tabindex="-1"></a><span class="in">OU PLOTFILE 1 ALL FIRST 1HRMAX1.PLT</span></span>
<span id="cb15-465"><a href="#cb15-465" aria-hidden="true" tabindex="-1"></a><span class="in">OU PLOTFILE 3 ALL FIRST 3HRMAX1.PLT</span></span>
<span id="cb15-466"><a href="#cb15-466" aria-hidden="true" tabindex="-1"></a><span class="in">OU FINISHED</span></span>
<span id="cb15-467"><a href="#cb15-467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-468"><a href="#cb15-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-469"><a href="#cb15-469" aria-hidden="true" tabindex="-1"></a><span class="fu">### Run the AERMOD model with custom parameters</span></span>
<span id="cb15-470"><a href="#cb15-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-471"><a href="#cb15-471" aria-hidden="true" tabindex="-1"></a>Once you have changed the parameters in the AERMOD.INP file to match your facility, you are ready to run the newly specified model using AERMOD. To run the model, navigate to the directory where aermod.inp, aermod.exe and the associated meteorological files are located. Double-click the aermod.exe executable file (or drag and release aermod.inp over aermod.exe). Allow AERMOD to cycle through all the days represented in your meteorological data (e.g., 365 days for each year). If you receive an error, check the sources of the error by reading the ERROR.OUT file in notepad or other text editor to review.</span>
<span id="cb15-472"><a href="#cb15-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-473"><a href="#cb15-473" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reformat model output data and export as ASCII grid</span></span>
<span id="cb15-474"><a href="#cb15-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-475"><a href="#cb15-475" aria-hidden="true" tabindex="-1"></a>Once AERMOD has completed the procedure without errors (i.e., if the *.PLT files have been created successfully), you will need to reformat the data in the plot files so that they are readable in ArcGIS Pro. Use the following code to simplify and format the data into five variables, (x for longitude, y for latitude, value for max concentrations, period, date). Use the code to convert the data frame into an ASCII grid and export the grid into your project data folder for import into ArcGIS Pro.</span>
<span id="cb15-476"><a href="#cb15-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-479"><a href="#cb15-479" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb15-480"><a href="#cb15-480" aria-hidden="true" tabindex="-1"></a><span class="co"># reformat 1-hour AERMOD fixed width PLT output as R data frame </span></span>
<span id="cb15-481"><a href="#cb15-481" aria-hidden="true" tabindex="-1"></a>emissions_1hr_df <span class="ot">&lt;-</span></span>
<span id="cb15-482"><a href="#cb15-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.fwf</span>(</span>
<span id="cb15-483"><a href="#cb15-483" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">"aermod/1HRMAX1.PLT"</span>,</span>
<span id="cb15-484"><a href="#cb15-484" aria-hidden="true" tabindex="-1"></a>    <span class="at">skip =</span> <span class="dv">8</span>,</span>
<span id="cb15-485"><a href="#cb15-485" aria-hidden="true" tabindex="-1"></a>    <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">15</span>, <span class="dv">15</span>, <span class="dv">28</span>, <span class="dv">4</span>, <span class="dv">32</span>, <span class="dv">8</span>)</span>
<span id="cb15-486"><a href="#cb15-486" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb15-487"><a href="#cb15-487" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb15-488"><a href="#cb15-488" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> V1,</span>
<span id="cb15-489"><a href="#cb15-489" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> V2,</span>
<span id="cb15-490"><a href="#cb15-490" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> V3,</span>
<span id="cb15-491"><a href="#cb15-491" aria-hidden="true" tabindex="-1"></a>    <span class="at">period =</span> V5,</span>
<span id="cb15-492"><a href="#cb15-492" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_orig =</span> V7</span>
<span id="cb15-493"><a href="#cb15-493" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb15-494"><a href="#cb15-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">substr</span>(date_orig, <span class="dv">1</span>, <span class="dv">6</span>), <span class="st">"%y%m%d"</span>),</span>
<span id="cb15-495"><a href="#cb15-495" aria-hidden="true" tabindex="-1"></a>         <span class="at">hour =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(date_orig, <span class="dv">7</span>, <span class="dv">8</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb15-496"><a href="#cb15-496" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>date_orig)</span>
<span id="cb15-497"><a href="#cb15-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-498"><a href="#cb15-498" aria-hidden="true" tabindex="-1"></a><span class="co"># create histogram of 1-hour max concentrations</span></span>
<span id="cb15-499"><a href="#cb15-499" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(emissions_1hr_df, <span class="fu">aes</span>(<span class="at">x=</span>value)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"gray40"</span>, <span class="at">fill=</span><span class="st">"gray80"</span>)</span>
<span id="cb15-500"><a href="#cb15-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-501"><a href="#cb15-501" aria-hidden="true" tabindex="-1"></a><span class="co"># create raster grid of 1-hour max concentrations from dataframe, with resolution of 200m</span></span>
<span id="cb15-502"><a href="#cb15-502" aria-hidden="true" tabindex="-1"></a>emissions_1hr_grid <span class="ot">&lt;-</span> <span class="fu">rasterFromXYZ</span>(emissions_1hr_df, <span class="at">res=</span><span class="dv">200</span>)</span>
<span id="cb15-503"><a href="#cb15-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-504"><a href="#cb15-504" aria-hidden="true" tabindex="-1"></a><span class="co"># set projection and datum of grid in PROJ.4 format</span></span>
<span id="cb15-505"><a href="#cb15-505" aria-hidden="true" tabindex="-1"></a><span class="fu">projection</span>(emissions_1hr_grid) <span class="ot">=</span> <span class="fu">CRS</span>(<span class="st">"+proj=utm +zone=11 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"</span>)</span>
<span id="cb15-506"><a href="#cb15-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-507"><a href="#cb15-507" aria-hidden="true" tabindex="-1"></a><span class="co"># plot raster grid of 1-hour max concentrations in R</span></span>
<span id="cb15-508"><a href="#cb15-508" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(emissions_1hr_grid<span class="sc">$</span>value)</span>
<span id="cb15-509"><a href="#cb15-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-510"><a href="#cb15-510" aria-hidden="true" tabindex="-1"></a><span class="co"># export raster grid of 1-hour max concentrations as ASCII file</span></span>
<span id="cb15-511"><a href="#cb15-511" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(</span>
<span id="cb15-512"><a href="#cb15-512" aria-hidden="true" tabindex="-1"></a>  emissions_1hr<span class="sc">$</span>value,</span>
<span id="cb15-513"><a href="#cb15-513" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"aermod/emissions_1hr.asc"</span>,</span>
<span id="cb15-514"><a href="#cb15-514" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-515"><a href="#cb15-515" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">c</span>(<span class="st">'TFW=YES'</span>)</span>
<span id="cb15-516"><a href="#cb15-516" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-517"><a href="#cb15-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-518"><a href="#cb15-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-519"><a href="#cb15-519" aria-hidden="true" tabindex="-1"></a><span class="co"># reformat 3-hour AERMOD fixed width PLT output as R data frame </span></span>
<span id="cb15-520"><a href="#cb15-520" aria-hidden="true" tabindex="-1"></a>emissions_3hr_df <span class="ot">&lt;-</span> <span class="fu">read.fwf</span>(<span class="at">file =</span> <span class="st">"aermod/3HRMAX1.PLT"</span>,</span>
<span id="cb15-521"><a href="#cb15-521" aria-hidden="true" tabindex="-1"></a>                 <span class="at">skip =</span> <span class="dv">8</span>,</span>
<span id="cb15-522"><a href="#cb15-522" aria-hidden="true" tabindex="-1"></a>                 <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">15</span>,<span class="dv">15</span>,<span class="dv">15</span>,<span class="dv">28</span>,<span class="dv">4</span>,<span class="dv">32</span>,<span class="dv">8</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-523"><a href="#cb15-523" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">x =</span> V1,</span>
<span id="cb15-524"><a href="#cb15-524" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> V2,</span>
<span id="cb15-525"><a href="#cb15-525" aria-hidden="true" tabindex="-1"></a>         <span class="at">value =</span> V3,</span>
<span id="cb15-526"><a href="#cb15-526" aria-hidden="true" tabindex="-1"></a>         <span class="at">period =</span> V5,</span>
<span id="cb15-527"><a href="#cb15-527" aria-hidden="true" tabindex="-1"></a>         <span class="at">date_orig =</span> V7) <span class="sc">%&gt;%</span></span>
<span id="cb15-528"><a href="#cb15-528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">substr</span>(date_orig,<span class="dv">1</span>,<span class="dv">6</span>),<span class="st">"%y%m%d"</span>),</span>
<span id="cb15-529"><a href="#cb15-529" aria-hidden="true" tabindex="-1"></a>         <span class="at">hour =</span> <span class="fu">as.numeric</span>(<span class="fu">substr</span>(date_orig,<span class="dv">7</span>,<span class="dv">8</span>)))</span>
<span id="cb15-530"><a href="#cb15-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-531"><a href="#cb15-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-532"><a href="#cb15-532" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of 3-hour max concentrations</span></span>
<span id="cb15-533"><a href="#cb15-533" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(emissions_3hr_df, <span class="fu">aes</span>(<span class="at">x=</span>maxconc)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">color=</span><span class="st">"gray40"</span>, <span class="at">fill=</span><span class="st">"gray80"</span>)</span>
<span id="cb15-534"><a href="#cb15-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-535"><a href="#cb15-535" aria-hidden="true" tabindex="-1"></a><span class="co"># create raster grid of 3-hour max concentrations from dataframe, with resolution of 200m</span></span>
<span id="cb15-536"><a href="#cb15-536" aria-hidden="true" tabindex="-1"></a>emissions_3hr <span class="ot">&lt;-</span> <span class="fu">rasterFromXYZ</span>(emissions_3hr_df, <span class="at">res=</span><span class="dv">200</span>)</span>
<span id="cb15-537"><a href="#cb15-537" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(emissions_3hr<span class="sc">$</span>value)</span>
<span id="cb15-538"><a href="#cb15-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-539"><a href="#cb15-539" aria-hidden="true" tabindex="-1"></a><span class="co"># set projection and datum in PROJ.4 format</span></span>
<span id="cb15-540"><a href="#cb15-540" aria-hidden="true" tabindex="-1"></a><span class="fu">projection</span>(emissions_3hr) <span class="ot">=</span> <span class="fu">CRS</span>(<span class="st">"+proj=utm +zone=11 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"</span>)</span>
<span id="cb15-541"><a href="#cb15-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-542"><a href="#cb15-542" aria-hidden="true" tabindex="-1"></a><span class="co"># create preliminary plot of 3-hour max concentrations</span></span>
<span id="cb15-543"><a href="#cb15-543" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(emissions_3hr<span class="sc">$</span>value)</span>
<span id="cb15-544"><a href="#cb15-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-545"><a href="#cb15-545" aria-hidden="true" tabindex="-1"></a><span class="co"># export raster grid of 3-hour max concentrations</span></span>
<span id="cb15-546"><a href="#cb15-546" aria-hidden="true" tabindex="-1"></a><span class="fu">writeRaster</span>(</span>
<span id="cb15-547"><a href="#cb15-547" aria-hidden="true" tabindex="-1"></a>  emissions_1hr<span class="sc">$</span>value,</span>
<span id="cb15-548"><a href="#cb15-548" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">"aermod/emissions_3hr.asc"</span>,</span>
<span id="cb15-549"><a href="#cb15-549" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-550"><a href="#cb15-550" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">c</span>(<span class="st">'TFW=YES'</span>)</span>
<span id="cb15-551"><a href="#cb15-551" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-552"><a href="#cb15-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-553"><a href="#cb15-553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb15-554"><a href="#cb15-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-555"><a href="#cb15-555" aria-hidden="true" tabindex="-1"></a><span class="fu">## Step 6. Create final maps and figures in ArcGIS Pro</span></span>
<span id="cb15-556"><a href="#cb15-556" aria-hidden="true" tabindex="-1"></a>Return to ArcGIS Pro and import the ASCII grids into your existing map via the Catalog Pane or Add Data menu option. Create a custom layout with standard map elements (i.e., north arrow, scale bar and data source, etc.) Modify the symbology for the pollution concentration grids as desired. Copy the 1-hour and 3-hour single facility max concentrations maps and histograms into the appropriate PowerPoint slide. Lastly, copy the statistics for the two grids into the summary table in PowerPoint. Summarize your results. In your write-up, consider the degree to which the single facility you modeled contributes to the overall pollution burden within your study area. Also consider any limitations or concerns you may have about the pollution estimates (e.g., what is excluded from the model).</span>
<span id="cb15-557"><a href="#cb15-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-558"><a href="#cb15-558" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cumulative emissions *(optional)*</span></span>
<span id="cb15-559"><a href="#cb15-559" aria-hidden="true" tabindex="-1"></a>Add additional facilities to the SOurce pathway to calculate SO2 emissions for multiple facilities within and proximate to your study area. For the multiple facilities (or cumulative analysis), begin by selecting all facilities inside and within one kilometer of your study area (hint: use the buffer distance option under the "select by location" option under the "Select" menu). Open the attribute table and copy the facility information into Excel. Use the provided AERMODFormatting.xlsx spreadsheet to format source location and source parameter specifications for the new AERMOD facilities. Re-run the AERMOD.INP with updated facility information and plot the results. Compare the modeled pollutant concentrations in the cumulative model to the regulatory reference concentrations (<span class="co">[</span><span class="ot">US EPA national air quality standards</span><span class="co">](https://www.epa.gov/criteria-air-pollutants/naaqs-table)</span>. Do the concentrations exceed the reference concentrations?</span>
<span id="cb15-560"><a href="#cb15-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-561"><a href="#cb15-561" aria-hidden="true" tabindex="-1"></a>::: {.callout-note collapse="false"}</span>
<span id="cb15-562"><a href="#cb15-562" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparison concentrations</span></span>
<span id="cb15-563"><a href="#cb15-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-564"><a href="#cb15-564" aria-hidden="true" tabindex="-1"></a>Note that you will need to <span class="co">[</span><span class="ot">convert the ppb and ppm standards to ug/m\^3</span><span class="co">](https://www.breeze-technologies.de/blog/air-pollution-how-to-convert-between-mgm3-%C2%B5gm3-ppm-ppb/)</span> in order to compare with AERMOD output. The 1-hour average primary standard 75 ppb is equal to 196.5 ug/m\^3 and the 3-hour average 0.5 ppm secondary standard is equal to 1,310 ug/m\^3</span>
<span id="cb15-565"><a href="#cb15-565" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb15-566"><a href="#cb15-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-567"><a href="#cb15-567" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model seasonal variation in toxic air concentrations *(optional)*</span></span>
<span id="cb15-568"><a href="#cb15-568" aria-hidden="true" tabindex="-1"></a>Use the TRI inhalation toxicity weights to model toxic air releases within your study area from large, industrial facilities represented in the latest (2020) EPA's Toxics Release Inventory or TRI report. The TRI reports emissions by facility for each of the 650 toxics and toxic compounds. Given that every chemical has a different dose-response curve or, more simply, a different toxicological profile, use the inhalation toxicity weighted factors (ITW) from EPA's Risk-Screening Environmental Indicators (RSEI) to model pollution burden. Change the STARTEND parameter in the MEteorological pathway to create four separate maps, one for each season. Describe seasonal variations in emissions burden across your study area.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>